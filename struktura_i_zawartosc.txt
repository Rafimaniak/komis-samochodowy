Eksport struktury katalogw i plikw
Wygenerowano: 11/25/2025 13:30:21



CIEKA: src\main\java\pl\komis\KomisApplication.java
--------------------------------------------------------
package pl.komis;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

@SpringBootApplication
public class KomisApplication {

    public static void main(String[] args) {
//        // Tymczasowe generowanie hase
//        BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
//
//        System.out.println("=== GENEROWANIE HASE BCrypt ===");
//        System.out.println("admin: " + encoder.encode("admin"));
//        System.out.println("user: " + encoder.encode("user"));
//        System.out.println("testowy: " + encoder.encode("testowy"));
//        System.out.println("=== KONIEC ===");

        SpringApplication.run(KomisApplication.class, args);
    }
}


CIEKA: src\main\java\pl\komis\config\DataLoader.java
---------------------------------------------------------
package pl.komis.config;

import lombok.RequiredArgsConstructor;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;
import pl.komis.model.Samochod;
import pl.komis.repository.SamochodRepository;

import java.math.BigDecimal;
import java.time.LocalDate;

@Component
@RequiredArgsConstructor
public class DataLoader implements CommandLineRunner {

    private final SamochodRepository samochodRepository;

    @Override
    public void run(String... args) {
        if (samochodRepository.count() == 0) {
            // Dodaj samochody z wszystkimi wymaganymi polami
            Samochod s1 = new Samochod();
            s1.setMarka("BMW");
            s1.setModel("Seria 3");
            s1.setRokProdukcji(2020);
            s1.setPrzebieg(50000);
            s1.setPojemnoscSilnika(2.0);
            s1.setRodzajPaliwa("Benzyna");
            s1.setSkrzyniaBiegow("Automatyczna");
            s1.setKolor("Czarny");
            s1.setCena(new BigDecimal("120000"));
            s1.setStatus("DOSTEPNY");
            s1.setDataDodania(LocalDate.now());

            Samochod s2 = new Samochod();
            s2.setMarka("Audi");
            s2.setModel("A4");
            s2.setRokProdukcji(2019);
            s2.setPrzebieg(60000);
            s2.setPojemnoscSilnika(2.0);
            s2.setRodzajPaliwa("Diesel");
            s2.setSkrzyniaBiegow("Manualna");
            s2.setKolor("Biay");
            s2.setCena(new BigDecimal("95000"));
            s2.setStatus("DOSTEPNY");
            s2.setDataDodania(LocalDate.now());

            samochodRepository.save(s1);
            samochodRepository.save(s2);

            System.out.println("Dodano samochody do bazy!");
        }
    }
}


CIEKA: src\main\java\pl\komis\config\SecurityConfig.java
-------------------------------------------------------------
package pl.komis.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;
import pl.komis.service.CustomUserDetailsService;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final CustomUserDetailsService customUserDetailsService;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests(auth -> auth
                        // Strony publiczne - dostpne bez logowania
                        .requestMatchers("/", "/css/**", "/js/**", "/images/**", "/api/**",
                                "/samochody", "/samochody/szczegoly", "/register",
                                "/generate-password", "/test-passwords",
                                "/search", "/search/**", "/search/quick", "/search/quick/**").permitAll() // DODANO BRAKUJCE ENDPOINTY

                        // Strony admina - wymagaj roli ADMIN
                        .requestMatchers("/admin/**").hasRole("ADMIN")
                        .requestMatchers("/klienci", "/pracownicy").hasRole("ADMIN")
                        .requestMatchers("/samochody/nowy", "/samochody/edytuj/**",
                                "/samochody/zapisz", "/samochody/usun/**").hasRole("ADMIN")

                        // Wszystkie inne strony wymagaj logowania
                        .anyRequest().authenticated()
                )
                .formLogin(form -> form
                        .loginPage("/login")
                        .defaultSuccessUrl("/samochody", true)
                        .permitAll()
                )
                .logout(logout -> logout
                        .logoutRequestMatcher(new AntPathRequestMatcher("/logout"))
                        .logoutSuccessUrl("/?logout=true")
                        .invalidateHttpSession(true)
                        .deleteCookies("JSESSIONID")
                        .permitAll()
                )
                .userDetailsService(customUserDetailsService);

        return http.build();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}


CIEKA: src\main\java\pl\komis\controller\AdminController.java
------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import pl.komis.service.SamochodService;
import pl.komis.service.UserService;

@Controller
@RequestMapping("/admin")
@PreAuthorize("hasRole('ADMIN')")
@RequiredArgsConstructor
public class AdminController {

    private final UserService userService;
    private final SamochodService samochodService;

    @GetMapping
    public String adminPanel(Model model) {
        long totalUsers = userService.count();
        long totalCars = samochodService.findAll().size();
        long availableCars = samochodService.findByStatus("DOSTEPNY").size();

        model.addAttribute("totalUsers", totalUsers);
        model.addAttribute("totalCars", totalCars);
        model.addAttribute("availableCars", availableCars);
        model.addAttribute("tytul", "Panel Administracyjny");

        return "admin/panel";
    }
}


CIEKA: src\main\java\pl\komis\controller\AdminUserController.java
----------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import pl.komis.model.User;
import pl.komis.service.UserService;

import java.util.Arrays;
import java.util.List;

@Controller
@RequestMapping("/admin/users")
@PreAuthorize("hasRole('ADMIN')")
@RequiredArgsConstructor
public class AdminUserController {

    private final UserService userService;
    private final PasswordEncoder passwordEncoder;

    @GetMapping
    public String listUsers(Model model) {
        List<User> users = userService.findAll();
        model.addAttribute("users", users);
        model.addAttribute("tytul", "Zarzdzanie u偶ytkownikami");
        return "admin/users";
    }

    @GetMapping("/create")
    public String showCreateForm(Model model) {
        model.addAttribute("user", new User());
        model.addAttribute("tytul", "Dodaj nowego u偶ytkownika");
        model.addAttribute("roles", Arrays.asList("USER", "ADMIN"));
        return "admin/user-form";
    }

    @PostMapping("/create")
    public String createUser(@ModelAttribute User user,
                             @RequestParam("password") String password,
                             @RequestParam("role") String role,
                             RedirectAttributes redirectAttributes) {
        try {
            userService.createUserByAdmin(user, password, role);
            redirectAttributes.addFlashAttribute("successMessage", "U偶ytkownik zosta utworzony pomylnie");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "Bd podczas tworzenia u偶ytkownika: " + e.getMessage());
        }
        return "redirect:/admin/users";
    }

    @GetMapping("/edit/{id}")
    public String showEditForm(@PathVariable("id") Long id, Model model) {
        User user = userService.findById(id)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));
        model.addAttribute("user", user);
        model.addAttribute("tytul", "Edytuj u偶ytkownika");
        model.addAttribute("roles", Arrays.asList("USER", "ADMIN"));
        return "admin/user-form";
    }

    @PostMapping("/edit/{id}")
    public String updateUser(@PathVariable("id") Long id,
                             @ModelAttribute User user,
                             @RequestParam(value = "newPassword", required = false) String newPassword,
                             RedirectAttributes redirectAttributes) {
        try {
            User existingUser = userService.findById(id)
                    .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

            existingUser.setUsername(user.getUsername());
            existingUser.setEmail(user.getEmail());
            existingUser.setRole(user.getRole());
            existingUser.setEnabled(user.getEnabled());

            // Zmiana hasa jeli podano nowe
            if (newPassword != null && !newPassword.trim().isEmpty()) {
                existingUser.setPassword(passwordEncoder.encode(newPassword));
            }

            userService.updateUser(existingUser);
            redirectAttributes.addFlashAttribute("successMessage", "U偶ytkownik zosta zaktualizowany pomylnie");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "Bd podczas aktualizacji u偶ytkownika: " + e.getMessage());
        }
        return "redirect:/admin/users";
    }

    @GetMapping("/change-password/{id}")
    public String showChangePasswordForm(@PathVariable("id") Long id, Model model) {
        User user = userService.findById(id)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));
        model.addAttribute("user", user);
        model.addAttribute("tytul", "Zmiana hasa u偶ytkownika");
        return "admin/change-password";
    }

    @PostMapping("/change-password/{id}")
    public String changePassword(@PathVariable("id") Long id,
                                 @RequestParam("newPassword") String newPassword,
                                 @RequestParam("confirmPassword") String confirmPassword,
                                 RedirectAttributes redirectAttributes) {
        try {
            if (!newPassword.equals(confirmPassword)) {
                redirectAttributes.addFlashAttribute("errorMessage", "Hasa nie s identyczne");
                return "redirect:/admin/users/change-password/" + id;
            }

            User user = userService.findById(id)
                    .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

            user.setPassword(passwordEncoder.encode(newPassword));
            userService.updateUser(user);

            redirectAttributes.addFlashAttribute("successMessage", "Haso zostao zmienione pomylnie");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "Bd podczas zmiany hasa: " + e.getMessage());
        }
        return "redirect:/admin/users";
    }

    @PostMapping("/toggle-status/{id}")
    public String toggleUserStatus(@PathVariable("id") Long id, RedirectAttributes redirectAttributes) {
        try {
            User user = userService.findById(id)
                    .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

            user.setEnabled(!user.getEnabled());
            userService.updateUser(user);

            String status = user.getEnabled() ? "aktywowane" : "dezaktywowane";
            redirectAttributes.addFlashAttribute("successMessage",
                    "Konto u偶ytkownika " + user.getUsername() + " zostao " + status);
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "Bd podczas zmiany statusu u偶ytkownika: " + e.getMessage());
        }
        return "redirect:/admin/users";
    }

    @PostMapping("/delete/{id}")
    public String deleteUser(@PathVariable("id") Long id, RedirectAttributes redirectAttributes) {
        try {
            User user = userService.findById(id)
                    .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

            userService.deleteUser(id);
            redirectAttributes.addFlashAttribute("successMessage",
                    "U偶ytkownik " + user.getUsername() + " zosta usunity pomylnie");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("errorMessage", "Bd podczas usuwania u偶ytkownika: " + e.getMessage());
        }
        return "redirect:/admin/users";
    }
}


CIEKA: src\main\java\pl\komis\controller\KlientController.java
-------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import pl.komis.model.User;
import pl.komis.service.UserService;

import java.util.List;
import java.util.stream.Collectors;

@Controller
@RequiredArgsConstructor
@PreAuthorize("hasRole('ADMIN')")
public class KlientController {

    private final UserService userService;

    @GetMapping("/klienci")
    public String listaKlientow(Model model) {
        // Pobierz wszystkich u偶ytkownik贸w z rol USER
        List<User> klienci = userService.findAll().stream()
                .filter(user -> "USER".equals(user.getRole()))
                .collect(Collectors.toList());

        model.addAttribute("klienci", klienci);
        model.addAttribute("tytul", "Lista Klient贸w");
        return "klienci";
    }
}


CIEKA: src\main\java\pl\komis\controller\KlientPromocjaController.java
---------------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import pl.komis.model.KlientPromocja;
import pl.komis.service.KlientPromocjaService;

import java.util.List;

@RestController
@RequestMapping("/api/klient-promocje")
@RequiredArgsConstructor
public class KlientPromocjaController {

    private final KlientPromocjaService klientPromocjaService;

    @GetMapping
    public List<KlientPromocja> getAll() {
        return klientPromocjaService.findAll();
    }

    @GetMapping("/{id}")
    public ResponseEntity<KlientPromocja> getById(@PathVariable Long id) {
        return ResponseEntity.ok(klientPromocjaService.findById(id));
    }

    @PostMapping("/assign/{idKlienta}/{idPromocji}")
    public ResponseEntity<KlientPromocja> assign(@PathVariable Long idKlienta,
                                                 @PathVariable Long idPromocji) {
        return ResponseEntity.ok(
                klientPromocjaService.assignPromotion(idKlienta, idPromocji)
        );
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable Long id) {
        klientPromocjaService.remove(id);
        return ResponseEntity.noContent().build();
    }

    @GetMapping("/by-klient/{idKlienta}")
    public List<KlientPromocja> byKlient(@PathVariable Long idKlienta) {
        return klientPromocjaService.findByKlientId(idKlienta);
    }

    @GetMapping("/by-promocja/{idPromocji}")
    public List<KlientPromocja> byPromocja(@PathVariable Long idPromocji) {
        return klientPromocjaService.findByPromocjaId(idPromocji);
    }
}



CIEKA: src\main\java\pl\komis\controller\LoginController.java
------------------------------------------------------------------
package pl.komis.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class LoginController {

    @GetMapping("/login")
    public String login() {
        return "login";
    }
}


CIEKA: src\main\java\pl\komis\controller\PasswordGeneratorController.java
------------------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
@RequiredArgsConstructor
public class PasswordGeneratorController {

    private final PasswordEncoder passwordEncoder;

    @GetMapping("/password-generator")
    public String showPasswordGenerator() {
        return "password-generator";
    }

    @GetMapping("/generate")
    public String generatePassword(@RequestParam String password, Model model) {
        String encodedPassword = passwordEncoder.encode(password);

        model.addAttribute("rawPassword", password);
        model.addAttribute("encodedPassword", encodedPassword);
        model.addAttribute("sqlUpdate",
                "UPDATE users SET password = '" + encodedPassword + "' WHERE username = 'twoja_nazwa_uzytkownika';");

        return "password-generator";
    }
}


CIEKA: src\main\java\pl\komis\controller\PracownikController.java
----------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import pl.komis.model.User;
import pl.komis.service.UserService;

import java.util.List;
import java.util.stream.Collectors;

@Controller
@RequiredArgsConstructor
@PreAuthorize("hasRole('ADMIN')")
public class PracownikController {

    private final UserService userService;

    @GetMapping("/pracownicy")
    public String listaPracownikow(Model model) {
        // Pobierz wszystkich u偶ytkownik贸w z rol ADMIN
        List<User> pracownicy = userService.findAll().stream()
                .filter(user -> "ADMIN".equals(user.getRole()))
                .collect(Collectors.toList());

        model.addAttribute("pracownicy", pracownicy);
        model.addAttribute("tytul", "Lista Pracownik贸w");
        return "pracownicy";
    }
}


CIEKA: src\main\java\pl\komis\controller\PromocjaController.java
---------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import pl.komis.model.Promocja;
import pl.komis.service.PromocjaService;

import java.util.List;
import java.util.NoSuchElementException;

@RestController
@RequestMapping("/api/promocje")
@RequiredArgsConstructor
public class PromocjaController {

    private final PromocjaService promocjaService;

    @GetMapping
    public List<Promocja> getAll() {
        return promocjaService.findAll();
    }

    @GetMapping("/{id}")
    public ResponseEntity<Promocja> getById(@PathVariable Long id) {
        try {
            return ResponseEntity.ok(promocjaService.getById(id));
        } catch (NoSuchElementException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @PostMapping
    public ResponseEntity<Promocja> create(@RequestBody Promocja p) {
        Promocja created = promocjaService.save(p);
        return ResponseEntity.ok(created);
    }

    @PutMapping("/{id}")
    public ResponseEntity<Promocja> update(@PathVariable Long id, @RequestBody Promocja p) {
        try {
            Promocja updated = promocjaService.update(id, p);
            return ResponseEntity.ok(updated);
        } catch (NoSuchElementException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable Long id) {
        try {
            promocjaService.remove(id);
            return ResponseEntity.noContent().build();
        } catch (NoSuchElementException e) {
            return ResponseEntity.notFound().build();
        }
    }

    @GetMapping("/aktywne")
    public List<Promocja> getActive() {
        return promocjaService.findActive();
    }
}



CIEKA: src\main\java\pl\komis\controller\RegisterController.java
---------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import pl.komis.dto.RegisterRequest;
import pl.komis.model.User;
import pl.komis.service.UserService;

import jakarta.validation.Valid;

@Controller
@RequiredArgsConstructor
public class RegisterController {

    private final UserService userService;

    @GetMapping("/register")
    public String showRegistrationForm(Model model) {
        model.addAttribute("registerRequest", new RegisterRequest());
        model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
        return "register";
    }

    @PostMapping("/register")
    public String registerUser(@Valid @ModelAttribute RegisterRequest registerRequest,
                               BindingResult bindingResult,
                               Model model,
                               RedirectAttributes redirectAttributes) {

        // Walidacja podstawowa
        if (bindingResult.hasErrors()) {
            model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
            return "register";
        }

        // Walidacja hasa
        if (!registerRequest.getPassword().equals(registerRequest.getConfirmPassword())) {
            bindingResult.rejectValue("confirmPassword", "error.registerRequest", "Hasa nie s identyczne");
            model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
            return "register";
        }

        // Sprawd藕 czy u偶ytkownik ju偶 istnieje
        if (userService.usernameExists(registerRequest.getUsername())) {
            bindingResult.rejectValue("username", "error.registerRequest", "Nazwa u偶ytkownika jest ju偶 zajta");
            model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
            return "register";
        }

        if (userService.emailExists(registerRequest.getEmail())) {
            bindingResult.rejectValue("email", "error.registerRequest", "Email jest ju偶 zajty");
            model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
            return "register";
        }

        try {
            // Stw贸rz nowego u偶ytkownika
            User user = User.builder()
                    .username(registerRequest.getUsername())
                    .email(registerRequest.getEmail())
                    .role("USER")
                    .build();

            userService.registerUser(user, registerRequest.getPassword());

            redirectAttributes.addFlashAttribute("successMessage", "Konto zostao utworzone pomylnie! Mo偶esz si teraz zalogowa.");
            return "redirect:/login";

        } catch (Exception e) {
            model.addAttribute("errorMessage", "Wystpi bd podczas rejestracji: " + e.getMessage());
            model.addAttribute("tytul", "Rejestracja - Komis Samochodowy");
            return "register";
        }
    }
}


CIEKA: src\main\java\pl\komis\controller\SamochodController.java
---------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import pl.komis.model.Samochod;
import pl.komis.service.SamochodService;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.List;

@Controller
@RequestMapping("/samochody")
@RequiredArgsConstructor
public class SamochodController {

    private final SamochodService samochodService;

    // Widok listy samochod贸w z wyszukiwark
    @GetMapping
    public String listaSamochodow(
            @RequestParam(required = false) String marka,
            @RequestParam(required = false) String model,
            @RequestParam(required = false) String status,
            @RequestParam(required = false) Integer minRok,
            @RequestParam(required = false) Integer maxRok,
            @RequestParam(required = false) Integer minPrzebieg,
            @RequestParam(required = false) Integer maxPrzebieg,
            @RequestParam(required = false) BigDecimal minCena,
            @RequestParam(required = false) BigDecimal maxCena,
            Model modelAttr) {

        List<Samochod> samochody;

        // Sprawd藕 czy s parametry wyszukiwania (uwzgldniajc puste stringi)
        boolean hasSearchParams = (marka != null && !marka.trim().isEmpty()) ||
                (model != null && !model.trim().isEmpty()) ||
                (status != null && !status.trim().isEmpty()) ||
                minRok != null || maxRok != null ||
                minPrzebieg != null || maxPrzebieg != null ||
                minCena != null || maxCena != null;

        if (hasSearchParams) {
            // U偶yj zaawansowanego wyszukiwania
            SamochodService.SearchCriteria criteria = new SamochodService.SearchCriteria();
            criteria.setMarka(marka);
            criteria.setModel(model);
            criteria.setStatus(status);
            criteria.setMinRok(minRok);
            criteria.setMaxRok(maxRok);
            criteria.setMinPrzebieg(minPrzebieg);
            criteria.setMaxPrzebieg(maxPrzebieg);
            criteria.setMinCena(minCena);
            criteria.setMaxCena(maxCena);

            samochody = samochodService.searchCars(criteria);

            // DEBUG: Sprawd藕 wyniki wyszukiwania
            System.out.println("DEBUG: Kryteria wyszukiwania: " + criteria);
            System.out.println("DEBUG: Znaleziono samochod贸w: " + samochody.size());
        } else {
            // Poka偶 wszystkie samochody
            samochody = samochodService.findAll();
        }

        modelAttr.addAttribute("samochody", samochody);
        modelAttr.addAttribute("marki", samochodService.findAllMarki());
        modelAttr.addAttribute("tytul", "Lista Samochod贸w");
        modelAttr.addAttribute("hasSearchParams", hasSearchParams);

        // Przeka偶 parametry wyszukiwania z powrotem do formularza
        modelAttr.addAttribute("searchMarka", marka);
        modelAttr.addAttribute("searchModel", model);
        modelAttr.addAttribute("searchStatus", status);
        modelAttr.addAttribute("searchMinRok", minRok);
        modelAttr.addAttribute("searchMaxRok", maxRok);
        modelAttr.addAttribute("searchMinPrzebieg", minPrzebieg);
        modelAttr.addAttribute("searchMaxPrzebieg", maxPrzebieg);
        modelAttr.addAttribute("searchMinCena", minCena);
        modelAttr.addAttribute("searchMaxCena", maxCena);

        return "samochody/lista";
    }

    // Pozostae metody pozostaj bez zmian...
    @GetMapping("/szczegoly")
    public String szczegolySamochodu(@RequestParam("id") Long id, Model model) {
        Samochod samochod = samochodService.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));
        model.addAttribute("samochod", samochod);
        model.addAttribute("tytul", samochod.getMarka() + " " + samochod.getModel());
        return "samochody/szczegoly";
    }

    // Formularz dodawania nowego samochodu - tylko ADMIN
    @GetMapping("/nowy")
    @PreAuthorize("hasRole('ADMIN')")
    public String formNowySamochod(Model model) {
        model.addAttribute("samochod", new Samochod());
        model.addAttribute("tytul", "Dodaj Nowy Samoch贸d");
        return "samochody/form";
    }

    // Zapisywanie nowego samochodu - tylko ADMIN
    @PostMapping("/zapisz")
    @PreAuthorize("hasRole('ADMIN')")
    public String zapiszSamochod(@ModelAttribute Samochod samochod) {
        // Ustaw domylne wartoci dla brakujcych p贸l
        if (samochod.getDataDodania() == null) {
            samochod.setDataDodania(LocalDate.now());
        }
        if (samochod.getRodzajPaliwa() == null) {
            samochod.setRodzajPaliwa("Benzyna");
        }
        if (samochod.getSkrzyniaBiegow() == null) {
            samochod.setSkrzyniaBiegow("Manualna");
        }
        if (samochod.getPojemnoscSilnika() == null) {
            samochod.setPojemnoscSilnika(2.0);
        }

        samochodService.save(samochod);
        return "redirect:/samochody";
    }

    // Formularz edycji samochodu - tylko ADMIN
    @GetMapping("/edytuj")
    @PreAuthorize("hasRole('ADMIN')")
    public String formEdycjaSamochodu(@RequestParam("id") Long id, Model model) {
        Samochod samochod = samochodService.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));
        model.addAttribute("samochod", samochod);
        model.addAttribute("tytul", "Edytuj Samoch贸d");
        return "samochody/form";
    }

    // Aktualizacja samochodu - tylko ADMIN
    @PostMapping("/edytuj")
    @PreAuthorize("hasRole('ADMIN')")
    public String aktualizujSamochod(@RequestParam("id") Long id, @ModelAttribute Samochod samochod) {
        samochod.setId(id);
        samochodService.save(samochod);
        return "redirect:/samochody";
    }

    // Usuwanie samochodu - tylko ADMIN
    @PostMapping("/usun")
    @PreAuthorize("hasRole('ADMIN')")
    public String usunSamochod(@RequestParam("id") Long id) {
        samochodService.delete(id);
        return "redirect:/samochody";
    }

    // Rezerwacja samochodu - dla zalogowanych u偶ytkownik贸w
    @PostMapping("/zarezerwuj")
    @PreAuthorize("isAuthenticated()")
    public String zarezerwujSamochod(@RequestParam("id") Long id) {
        Samochod samochod = samochodService.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));

        if ("DOSTEPNY".equals(samochod.getStatus())) {
            samochod.setStatus("ZAREZERWOWANY");
            samochodService.save(samochod);
        }

        return "redirect:/samochody/szczegoly?id=" + id;
    }

    // Zakup samochodu - dla zalogowanych u偶ytkownik贸w
    @PostMapping("/kup")
    @PreAuthorize("isAuthenticated()")
    public String kupSamochod(@RequestParam("id") Long id) {
        Samochod samochod = samochodService.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));

        if ("DOSTEPNY".equals(samochod.getStatus()) || "ZAREZERWOWANY".equals(samochod.getStatus())) {
            samochod.setStatus("SPRZEDANY");
            samochodService.save(samochod);
        }

        return "redirect:/samochody/szczegoly?id=" + id;
    }

    // Anulowanie rezerwacji - dla zalogowanych u偶ytkownik贸w
    @PostMapping("/anuluj-rezerwacje")
    @PreAuthorize("isAuthenticated()")
    public String anulujRezerwacje(@RequestParam("id") Long id) {
        Samochod samochod = samochodService.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));

        if ("ZAREZERWOWANY".equals(samochod.getStatus())) {
            samochod.setStatus("DOSTEPNY");
            samochodService.save(samochod);
        }

        return "redirect:/samochody/szczegoly?id=" + id;
    }
}


CIEKA: src\main\java\pl\komis\controller\SearchController.java
-------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import pl.komis.model.Samochod;
import pl.komis.service.SamochodService;

import java.util.List;

@Controller
@RequestMapping("/search")
@RequiredArgsConstructor
public class SearchController {

    private final SamochodService samochodService;

    @GetMapping
    public String showSearchForm(Model model) {
        model.addAttribute("searchCriteria", new SamochodService.SearchCriteria());
        model.addAttribute("marki", samochodService.findAllMarki());
        model.addAttribute("tytul", "Zaawansowane wyszukiwanie");
        return "search/form";
    }

    @PostMapping
    public String searchCars(@ModelAttribute SamochodService.SearchCriteria criteria, Model model) {
        List<Samochod> results = samochodService.searchCars(criteria);

        // DEBUG
        System.out.println("DEBUG Zaawansowane wyszukiwanie:");
        System.out.println("DEBUG - Marka: " + criteria.getMarka());
        System.out.println("DEBUG - Model: " + criteria.getModel());
        System.out.println("DEBUG - Status: " + criteria.getStatus());
        System.out.println("DEBUG - Min rok: " + criteria.getMinRok());
        System.out.println("DEBUG - Max rok: " + criteria.getMaxRok());
        System.out.println("DEBUG - Wyniki: " + results.size() + " samochod贸w");

        model.addAttribute("searchCriteria", criteria);
        model.addAttribute("samochody", results);
        model.addAttribute("marki", samochodService.findAllMarki());
        model.addAttribute("tytul", "Wyniki wyszukiwania");
        model.addAttribute("resultsCount", results.size());

        return "search/results";
    }

    @GetMapping("/quick")
    public String quickSearch(
            @org.springframework.web.bind.annotation.RequestParam(required = false) String marka,
            @org.springframework.web.bind.annotation.RequestParam(required = false) String model,
            @org.springframework.web.bind.annotation.RequestParam(required = false) String status,
            Model modelAttr) {

        List<Samochod> results = samochodService.searchCarsSimple(marka, model, status);

        modelAttr.addAttribute("samochody", results);
        modelAttr.addAttribute("marki", samochodService.findAllMarki());
        modelAttr.addAttribute("tytul", "Szybkie wyszukiwanie");
        modelAttr.addAttribute("resultsCount", results.size());
        modelAttr.addAttribute("searchMarka", marka);
        modelAttr.addAttribute("searchModel", model);
        modelAttr.addAttribute("searchStatus", status);

        return "search/quick-results";
    }
}


CIEKA: src\main\java\pl\komis\controller\StatystykiController.java
-----------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import pl.komis.service.SamochodService;

import java.util.List;

@Controller
@RequestMapping("/stats")
@PreAuthorize("hasRole('ADMIN')")
@RequiredArgsConstructor
public class StatystykiController {

    private final SamochodService samochodService;

    @GetMapping
    public String showStats(Model model) {
        SamochodService.CarStatistics stats = samochodService.getCarStatistics();
        List<SamochodService.BrandStatistics> topBrands = samochodService.getTopBrands(10);

        model.addAttribute("stats", stats);
        model.addAttribute("topBrands", topBrands);
        model.addAttribute("tytul", "Statystyki samochod贸w");

        return "stats/car-stats";
    }

    @GetMapping("/sales")
    public String salesReport(
            @RequestParam(defaultValue = "2025") Integer year,
            @RequestParam(defaultValue = "11") Integer month,
            Model model) {

        List<SamochodService.MonthlySales> sales = samochodService.getMonthlySalesReport(year, month);

        model.addAttribute("sales", sales);
        model.addAttribute("year", year);
        model.addAttribute("month", month);
        model.addAttribute("tytul", "Raport sprzeda偶y");

        return "stats/sales-report";
    }
}


CIEKA: src\main\java\pl\komis\controller\StronaController.java
-------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import pl.komis.model.Samochod;
import pl.komis.service.SamochodService;

import java.util.List;

@Controller
@RequiredArgsConstructor
public class StronaController {

    private final SamochodService samochodService;

    @GetMapping("/")
    public String stronaGlowna(Model model) {
        List<Samochod> samochody = samochodService.findAll();
        model.addAttribute("samochody", samochody);
        model.addAttribute("tytul", "Komis Samochodowy - Strona G贸wna");

        // Sprawd藕 czy u偶ytkownik jest zalogowany
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        boolean isAuthenticated = authentication != null &&
                authentication.isAuthenticated() &&
                !authentication.getName().equals("anonymousUser");
        model.addAttribute("isAuthenticated", isAuthenticated);
        model.addAttribute("username", authentication.getName());

        return "index";
    }
}


CIEKA: src\main\java\pl\komis\controller\TestController.java
-----------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import pl.komis.model.User;
import pl.komis.repository.UserRepository;

@RestController
@RequiredArgsConstructor
public class TestController {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    @GetMapping("/api/debug/password")
    public String debugPassword(@RequestParam String username, @RequestParam String password) {
        User user = userRepository.findByUsername(username)
                .orElse(null);

        if (user == null) {
            return "User not found: " + username;
        }

        boolean matches = passwordEncoder.matches(password, user.getPassword());

        return String.format(
                "Username: %s<br>Stored password: %s<br>Input password: %s<br>Matches: %s<br>Password length: %d",
                username,
                user.getPassword(),
                password,
                matches,
                user.getPassword().length()
        );
    }

    @GetMapping("/api/debug/users")
    public String debugUsers() {
        StringBuilder result = new StringBuilder();
        result.append("<h3>All Users:</h3>");

        userRepository.findAll().forEach(user -> {
            result.append(String.format(
                    "Username: %s, Email: %s, Role: %s, Enabled: %s<br>",
                    user.getUsername(), user.getEmail(), user.getRole(), user.getEnabled()
            ));
        });

        return result.toString();
    }
}


CIEKA: src\main\java\pl\komis\controller\ZakupController.java
------------------------------------------------------------------
package pl.komis.controller;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import pl.komis.model.Zakup;
import pl.komis.service.*;

@Controller
@RequestMapping("/zakupy")
@RequiredArgsConstructor
public class ZakupController {

    private final ZakupService zakupService;
    private final SamochodService samochodService;
    private final KlientService klientService;
    private final PracownikService pracownikService;

    @GetMapping
    public String listZakupy(Model model) {
        model.addAttribute("zakupy", zakupService.findAll());
        model.addAttribute("tytul", "Lista Zakup贸w");
        return "zakupy_lista";
    }

    @GetMapping("/dodaj")
    public String showAddForm(Model model) {
        model.addAttribute("zakup", new Zakup());
        model.addAttribute("samochody", samochodService.findAll());
        model.addAttribute("klienci", klientService.findAll());
        model.addAttribute("pracownicy", pracownikService.findAll());
        return "zakupy_form";
    }

    @PostMapping("/dodaj")
    public String addZakup(@ModelAttribute Zakup zakup) {
        zakupService.save(zakup);
        return "redirect:/zakupy";
    }

    @GetMapping("/edytuj/{id}")
    public String editZakup(@PathVariable Long id, Model model) {
        model.addAttribute("zakup", zakupService.getById(id));
        model.addAttribute("samochody", samochodService.findAll());
        model.addAttribute("klienci", klientService.findAll());
        model.addAttribute("pracownicy", pracownikService.findAll());
        return "zakupy_form";
    }

    @PostMapping("/edytuj/{id}")
    public String updateZakup(@PathVariable Long id, @ModelAttribute Zakup zakup) {
        zakup.setId(id);
        zakupService.save(zakup);
        return "redirect:/zakupy";
    }

    @GetMapping("/usun/{id}")
    public String deleteZakup(@PathVariable Long id) {
        zakupService.remove(id);
        return "redirect:/zakupy";
    }
}



CIEKA: src\main\java\pl\komis\dto\RegisterRequest.java
-----------------------------------------------------------
package pl.komis.dto;

import lombok.Data;

@Data
public class RegisterRequest {
    private String username;
    private String email;
    private String password;
    private String confirmPassword;
}


CIEKA: src\main\java\pl\komis\model\Klient.java
----------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import java.util.List;

@Entity
public class Klient {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String imie;
    private String nazwisko;
    private String email;
    private String telefon;

    @OneToMany(mappedBy = "klient", cascade = CascadeType.ALL)
    private List<Zakup> zakupy;

    public Klient() {}

    // --- Gettery i settery ---
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getImie() {
        return imie;
    }

    public void setImie(String imie) {
        this.imie = imie;
    }

    public String getNazwisko() {
        return nazwisko;
    }

    public void setNazwisko(String nazwisko) {
        this.nazwisko = nazwisko;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public String getTelefon() {
        return telefon;
    }

    public void setTelefon(String telefon) {
        this.telefon = telefon;
    }

    public List<Zakup> getZakupy() {
        return zakupy;
    }

    public void setZakupy(List<Zakup> zakupy) {
        this.zakupy = zakupy;
    }
}



CIEKA: src\main\java\pl\komis\model\KlientPromocja.java
------------------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;

@Entity
@Table(name = "klienci_promocje")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class KlientPromocja {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    // klient, kt贸ry otrzyma promocj
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_klienta", nullable = false)
    private Klient klient;

    // promocja, kt贸ra zostaa przyznana
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_promocji", nullable = false)
    private Promocja promocja;

    private LocalDate dataPrzyznania;
}


CIEKA: src\main\java\pl\komis\model\Pracownik.java
-------------------------------------------------------
package pl.komis.model;


import jakarta.persistence.*;
import lombok.*;


import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;


@Entity
@Table(name = "pracownicy")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Pracownik {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String imie;
    private String nazwisko;
    private String stanowisko;
    private String telefon;
    private String email;
    private LocalDate dataZatrudnienia;

    @OneToMany(mappedBy = "pracownik")
    private List<Sprzedaz> sprzedaze = new ArrayList<>();

    @OneToMany(mappedBy = "pracownik")
    private List<Serwis> serwisy = new ArrayList<>();

    @OneToMany(mappedBy = "pracownik")
    private List<Zakup> zakupy = new ArrayList<>();
}


CIEKA: src\main\java\pl\komis\model\Promocja.java
------------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

@Entity
@Table(name = "promocje")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Promocja {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id; // ZMIANA: byo idPromocji

    @Column(nullable = false)
    private String nazwa;

    private String rodzaj;
    private Double wartosc;

    @Column(columnDefinition = "text")
    private String opis;

    private LocalDate dataRozpoczecia;
    private LocalDate dataZakonczenia;
    private Boolean aktywna;

    // TYMCZASOWO ZAKOMENTUJ RELACJ
    // @OneToMany(mappedBy = "promocja", cascade = CascadeType.ALL, orphanRemoval = true)
    // private List<KlientPromocja> klientPromocje = new ArrayList<>();
}


CIEKA: src\main\java\pl\komis\model\Samochod.java
------------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.LocalDate;

@Entity
@Table(name = "samochody")
public class Samochod {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String marka;
    private String model;
    private int rokProdukcji;
    private int przebieg;

    @Column(name = "pojemnosc_silnika")
    private Double pojemnoscSilnika;

    @Column(name = "rodzaj_paliwa")
    private String rodzajPaliwa;

    @Column(name = "skrzynia_biegow")
    private String skrzyniaBiegow;

    private String kolor;
    private BigDecimal cena;
    private String status;

    @Column(name = "data_dodania")
    private LocalDate dataDodania;

    // DODANE: Pole na zdjcie
    @Column(name = "zdjecie_url")
    private String zdjecieUrl;

    public Samochod() {}

    // --- Gettery i settery ---
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getMarka() {
        return marka;
    }

    public void setMarka(String marka) {
        this.marka = marka;
    }

    public String getModel() {
        return model;
    }

    public void setModel(String model) {
        this.model = model;
    }

    public int getRokProdukcji() {
        return rokProdukcji;
    }

    public void setRokProdukcji(int rokProdukcji) {
        this.rokProdukcji = rokProdukcji;
    }

    public int getPrzebieg() {
        return przebieg;
    }

    public void setPrzebieg(int przebieg) {
        this.przebieg = przebieg;
    }

    public Double getPojemnoscSilnika() {
        return pojemnoscSilnika;
    }

    public void setPojemnoscSilnika(Double pojemnoscSilnika) {
        this.pojemnoscSilnika = pojemnoscSilnika;
    }

    public String getRodzajPaliwa() {
        return rodzajPaliwa;
    }

    public void setRodzajPaliwa(String rodzajPaliwa) {
        this.rodzajPaliwa = rodzajPaliwa;
    }

    public String getSkrzyniaBiegow() {
        return skrzyniaBiegow;
    }

    public void setSkrzyniaBiegow(String skrzyniaBiegow) {
        this.skrzyniaBiegow = skrzyniaBiegow;
    }

    public String getKolor() {
        return kolor;
    }

    public void setKolor(String kolor) {
        this.kolor = kolor;
    }

    public BigDecimal getCena() {
        return cena;
    }

    public void setCena(BigDecimal cena) {
        this.cena = cena;
    }

    public String getStatus() {
        return status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    public LocalDate getDataDodania() {
        return dataDodania;
    }

    public void setDataDodania(LocalDate dataDodania) {
        this.dataDodania = dataDodania;
    }

    public String getZdjecieUrl() {
        return zdjecieUrl;
    }

    public void setZdjecieUrl(String zdjecieUrl) {
        this.zdjecieUrl = zdjecieUrl;
    }
}


CIEKA: src\main\java\pl\komis\model\Serwis.java
----------------------------------------------------
package pl.komis.model;


import jakarta.persistence.*;
import lombok.*;


import java.time.LocalDate;


@Entity
@Table(name = "serwis")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Serwis {


    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_samochodu")
    private Samochod samochod;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_pracownika")
    private Pracownik pracownik;


    @Column(columnDefinition = "text")
    private String opisUslugi;
    private Double koszt;
    private LocalDate dataSerwisu;
}


CIEKA: src\main\java\pl\komis\model\Sprzedaz.java
------------------------------------------------------
package pl.komis.model;


import jakarta.persistence.*;
import lombok.*;


import java.time.LocalDate;


@Entity
@Table(name = "sprzedaze")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Sprzedaz {


    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long idSprzedazy;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_samochodu")
    private Samochod samochod;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_klienta")
    private Klient klient;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_pracownika")
    private Pracownik pracownik;


    private LocalDate dataSprzedazy;
    private Double cenaSprzedazy;
    private String formaPlatnosci; // enum
}


CIEKA: src\main\java\pl\komis\model\User.java
--------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "users")
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true, nullable = false, length = 50)
    private String username;

    @Column(unique = true, nullable = false, length = 100)
    private String email;

    @Column(nullable = false, length = 255)
    private String password;

    @Column(length = 20)
    private String role;

    @Column(name = "enabled")
    private Boolean enabled;

    @Column(name = "created_at")
    private LocalDateTime createdAt;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "klient_id")
    private Klient klient;
}


CIEKA: src\main\java\pl\komis\model\Zakup.java
---------------------------------------------------
package pl.komis.model;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;
import java.math.BigDecimal;

@Entity
@Table(name = "zakupy")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Zakup {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_samochodu")
    private Samochod samochod;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_klienta")
    private Klient klient;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_pracownika")
    private Pracownik pracownik;

    private LocalDate dataZakupu;

    @Column(precision = 12, scale = 2)
    private BigDecimal cenaZakupu;
}



CIEKA: src\main\java\pl\komis\model\Zdjecie.java
-----------------------------------------------------
package pl.komis.model;


import jakarta.persistence.*;
import lombok.*;


@Entity
@Table(name = "zdjecia")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Zdjecie {


    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;


    private String url;
    @Column(length = 1000)
    private String opis;


    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "id_samochodu")
    private Samochod samochod;
}


CIEKA: src\main\java\pl\komis\repository\KlientPromocjaRepository.java
---------------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import pl.komis.model.KlientPromocja;

import java.util.List;

public interface KlientPromocjaRepository extends JpaRepository<KlientPromocja, Long> {

    @Query("SELECT kp FROM KlientPromocja kp WHERE kp.klient.id = :klientId")
    List<KlientPromocja> findByKlientId(@Param("klientId") Long klientId);

    @Query("SELECT kp FROM KlientPromocja kp WHERE kp.promocja.id = :promocjaId")
    List<KlientPromocja> findByPromocjaId(@Param("promocjaId") Long promocjaId);
}


CIEKA: src\main\java\pl\komis\repository\KlientRepository.java
-------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import pl.komis.model.Klient;

import java.util.Optional;

public interface KlientRepository extends JpaRepository<Klient, Long> {

    Optional<Klient> findByEmail(String email);
}



CIEKA: src\main\java\pl\komis\repository\PracownikRepository.java
----------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import pl.komis.model.Pracownik;

import java.util.List;

public interface PracownikRepository extends JpaRepository<Pracownik, Long> {

    List<Pracownik> findByStanowiskoIgnoreCase(String stanowisko);

    Pracownik findByEmail(String email);
}



CIEKA: src\main\java\pl\komis\repository\PromocjaRepository.java
---------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import pl.komis.model.Promocja;

import java.time.LocalDate;
import java.util.List;

public interface PromocjaRepository extends JpaRepository<Promocja, Long> {

    List<Promocja> findByDataRozpoczeciaBeforeAndDataZakonczeniaAfter(LocalDate from, LocalDate to);
}



CIEKA: src\main\java\pl\komis\repository\SamochodRepository.java
---------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.jpa.repository.query.Procedure;
import org.springframework.data.repository.query.Param;
import pl.komis.model.Samochod;

import java.math.BigDecimal;
import java.util.List;
import java.util.Map;

public interface SamochodRepository extends JpaRepository<Samochod, Long> {

    // ==================== PODSTAWOWE METODY WYSZUKIWANIA ====================

    @Query("SELECT s FROM Samochod s WHERE LOWER(s.marka) = LOWER(:marka)")
    List<Samochod> findByMarkaIgnoreCase(@Param("marka") String marka);

    @Query("SELECT s FROM Samochod s WHERE LOWER(s.model) = LOWER(:model)")
    List<Samochod> findByModelIgnoreCase(@Param("model") String model);

    @Query("SELECT s FROM Samochod s WHERE s.status = :status")
    List<Samochod> findByStatus(@Param("status") String status);

    @Query("SELECT s FROM Samochod s WHERE s.cena BETWEEN :minCena AND :maxCena")
    List<Samochod> findByCenaBetween(@Param("minCena") BigDecimal minCena,
                                     @Param("maxCena") BigDecimal maxCena);

    // ==================== PROCEDURY CRUD ====================

    @Procedure(procedureName = "create_car")
    Long createCar(
            @Param("p_marka") String marka,
            @Param("p_model") String model,
            @Param("p_rok_produkcji") Integer rokProdukcji,
            @Param("p_przebieg") Integer przebieg,
            @Param("p_pojemnosc_silnika") Double pojemnoscSilnika,
            @Param("p_rodzaj_paliwa") String rodzajPaliwa,
            @Param("p_skrzynia_biegow") String skrzyniaBiegow,
            @Param("p_kolor") String kolor,
            @Param("p_cena") BigDecimal cena,
            @Param("p_status") String status,
            @Param("p_zdjecie_url") String zdjecieUrl
    );

    @Procedure(procedureName = "update_car")
    void updateCar(
            @Param("p_id") Long id,
            @Param("p_marka") String marka,
            @Param("p_model") String model,
            @Param("p_rok_produkcji") Integer rokProdukcji,
            @Param("p_przebieg") Integer przebieg,
            @Param("p_pojemnosc_silnika") Double pojemnoscSilnika,
            @Param("p_rodzaj_paliwa") String rodzajPaliwa,
            @Param("p_skrzynia_biegow") String skrzyniaBiegow,
            @Param("p_kolor") String kolor,
            @Param("p_cena") BigDecimal cena,
            @Param("p_status") String status,
            @Param("p_zdjecie_url") String zdjecieUrl
    );

    @Procedure(procedureName = "delete_car")
    void deleteCar(@Param("p_id") Long id);

    // ==================== ZAAWANSOWANE WYSZUKIWANIE - BEZPOREDNIE ZAPYTANIE SQL ====================

    @Query(value = "SELECT s.* FROM samochody s " +
            "WHERE (:p_marka IS NULL OR LOWER(s.marka) = LOWER(:p_marka)) " +
            "AND (:p_model IS NULL OR LOWER(s.model) = LOWER(:p_model)) " +
            "AND (:p_min_rok IS NULL OR s.rok_produkcji >= :p_min_rok) " +
            "AND (:p_max_rok IS NULL OR s.rok_produkcji <= :p_max_rok) " +
            "AND (:p_min_przebieg IS NULL OR s.przebieg >= :p_min_przebieg) " +
            "AND (:p_max_przebieg IS NULL OR s.przebieg <= :p_max_przebieg) " +
            "AND (:p_min_cena IS NULL OR s.cena >= :p_min_cena) " +
            "AND (:p_max_cena IS NULL OR s.cena <= :p_max_cena) " +
            "AND (:p_rodzaj_paliwa IS NULL OR s.rodzaj_paliwa = :p_rodzaj_paliwa) " +
            "AND (:p_status IS NULL OR s.status = :p_status)", nativeQuery = true)
    List<Samochod> searchCars(
            @Param("p_marka") String marka,
            @Param("p_model") String model,
            @Param("p_min_rok") Integer minRok,
            @Param("p_max_rok") Integer maxRok,
            @Param("p_min_przebieg") Integer minPrzebieg,
            @Param("p_max_przebieg") Integer maxPrzebieg,
            @Param("p_min_cena") BigDecimal minCena,
            @Param("p_max_cena") BigDecimal maxCena,
            @Param("p_rodzaj_paliwa") String rodzajPaliwa,
            @Param("p_status") String status
    );

    // ==================== PROSTE WYSZUKIWANIE ====================

    @Query(value = "SELECT s.* FROM samochody s " +
            "WHERE (:p_marka IS NULL OR LOWER(s.marka) = LOWER(:p_marka)) " +
            "AND (:p_model IS NULL OR LOWER(s.model) = LOWER(:p_model)) " +
            "AND (:p_status IS NULL OR s.status = :p_status)", nativeQuery = true)
    List<Samochod> searchCarsSimple(
            @Param("p_marka") String marka,
            @Param("p_model") String model,
            @Param("p_status") String status
    );

    // ==================== PROCEDURY OPERACJI BIZNESOWYCH ====================

    @Procedure(procedureName = "reserve_car")
    Map<String, Object> reserveCar(
            @Param("p_car_id") Long carId,
            @Param("p_user_id") Long userId
    );

    @Procedure(procedureName = "sell_car")
    Map<String, Object> sellCar(
            @Param("p_car_id") Long carId,
            @Param("p_user_id") Long userId,
            @Param("p_employee_id") Long employeeId,
            @Param("p_final_price") BigDecimal finalPrice
    );

    @Procedure(procedureName = "cancel_reservation")
    Map<String, Object> cancelReservation(@Param("p_car_id") Long carId);

    // ==================== FUNKCJE RAPORTOWANIA I STATYSTYK ====================

    @Query(value = "SELECT * FROM get_available_cars()", nativeQuery = true)
    List<Object[]> getAvailableCars();

    @Query(value = "SELECT * FROM get_car_stats()", nativeQuery = true)
    Map<String, Object> getCarStatistics();

    @Query(value = "SELECT * FROM get_top_brands(:limit_count)", nativeQuery = true)
    List<Object[]> getTopBrands(@Param("limit_count") Integer limitCount);

    @Query(value = "SELECT * FROM get_monthly_sales_report_func(:p_year, :p_month)", nativeQuery = true)
    List<Object[]> getMonthlySalesReport(
            @Param("p_year") Integer year,
            @Param("p_month") Integer month
    );
}


CIEKA: src\main\java\pl\komis\repository\SerwisRepository.java
-------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import pl.komis.model.Serwis;

import java.time.LocalDate;
import java.util.List;

public interface SerwisRepository extends JpaRepository<Serwis, Long> {

    List<Serwis> findByDataSerwisuBetween(LocalDate od, LocalDate do_);

    // POPRAWIONE METODY Z @Query
    @Query("SELECT s FROM Serwis s WHERE s.samochod.id = :samochodId")
    List<Serwis> findBySamochodId(@Param("samochodId") Long samochodId);

    @Query("SELECT s FROM Serwis s WHERE s.pracownik.id = :pracownikId")
    List<Serwis> findByPracownikId(@Param("pracownikId") Long pracownikId);
}


CIEKA: src\main\java\pl\komis\repository\SprzedazRepository.java
---------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import pl.komis.model.Sprzedaz;

import java.time.LocalDate;
import java.util.List;

public interface SprzedazRepository extends JpaRepository<Sprzedaz, Long> {

    // ZAKOMENTUJ WSZYSTKIE METODY
    // List<Sprzedaz> findByDataSprzedazyBetween(LocalDate od, LocalDate do_);
    // List<Sprzedaz> findByPracownikIdPracownika(Long idPracownika);
    // List<Sprzedaz> findByKlientIdKlienta(Long idKlienta);
    // List<Sprzedaz> findBySamochodIdSamochodu(Long idSamochodu);
}


CIEKA: src\main\java\pl\komis\repository\UserRepository.java
-----------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.jpa.repository.query.Procedure;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import pl.komis.model.User;

import java.util.Optional;

@Repository
public interface UserRepository extends JpaRepository<User, Long> {

    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);
    boolean existsByUsername(String username);
    boolean existsByEmail(String email);

    // Wywoanie PROCEDURY tworzenia u偶ytkownika
    @Procedure(procedureName = "create_user")
    Long createUser(
            @Param("p_username") String username,
            @Param("p_email") String email,
            @Param("p_password") String password,
            @Param("p_role") String role,
            @Param("p_enabled") Boolean enabled
    );

    // Wywoanie PROCEDURY aktualizacji u偶ytkownika
    @Procedure(procedureName = "update_user")
    void updateUser(
            @Param("p_id") Long id,
            @Param("p_username") String username,
            @Param("p_email") String email,
            @Param("p_password") String password,
            @Param("p_role") String role,
            @Param("p_enabled") Boolean enabled
    );

    // Wywoanie PROCEDURY usuwania u偶ytkownika
    @Procedure(procedureName = "delete_user")
    void deleteUser(@Param("p_id") Long id);
}


CIEKA: src\main\java\pl\komis\repository\ZakupRepository.java
------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import pl.komis.model.Zakup;

import java.time.LocalDate;
import java.util.List;

public interface ZakupRepository extends JpaRepository<Zakup, Long> {

    List<Zakup> findByDataZakupuBetween(LocalDate od, LocalDate do_);

    // POPRAWIONE METODY Z @Query
    @Query("SELECT z FROM Zakup z WHERE z.klient.id = :klientId")
    List<Zakup> findByKlientId(@Param("klientId") Long klientId);

    @Query("SELECT z FROM Zakup z WHERE z.pracownik.id = :pracownikId")
    List<Zakup> findByPracownikId(@Param("pracownikId") Long pracownikId);
}


CIEKA: src\main\java\pl\komis\repository\ZdjecieRepository.java
--------------------------------------------------------------------
package pl.komis.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import pl.komis.model.Zdjecie;

import java.util.List;

public interface ZdjecieRepository extends JpaRepository<Zdjecie, Long> {

    @Query("SELECT z FROM Zdjecie z WHERE z.samochod.id = :samochodId")
    List<Zdjecie> findBySamochodId(@Param("samochodId") Long samochodId);
}


CIEKA: src\main\java\pl\komis\service\CustomUserDetailsService.java
------------------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import pl.komis.model.User;
import pl.komis.repository.UserRepository;

import java.util.Collection;
import java.util.Collections;

@Slf4j
@Service
@RequiredArgsConstructor
public class CustomUserDetailsService implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        log.info("=== PRBA LOGOWANIA ===");
        log.info("Szukam u偶ytkownika: {}", username);

        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> {
                    log.error(" U偶ytkownik nie znaleziony: {}", username);
                    return new UsernameNotFoundException("U偶ytkownik nie znaleziony: " + username);
                });

        log.info(" Znaleziono u偶ytkownika: {}", user.getUsername());
        log.info(" Email: {}", user.getEmail());
        log.info(" Rola: {}", user.getRole());
        log.info(" Enabled: {}", user.getEnabled());
        log.info(" Dugo hasa: {}", user.getPassword() != null ? user.getPassword().length() : "NULL");
        log.info("=== KONIEC WCZYTYWANIA U呕YTKOWNIKA ===");

        // Sprawd藕 czy u偶ytkownik jest enabled
        if (user.getEnabled() != null && !user.getEnabled()) {
            log.error(" Konto u偶ytkownika {} jest wyczone", username);
            throw new UsernameNotFoundException("Konto jest wyczone: " + username);
        }

        return new org.springframework.security.core.userdetails.User(
                user.getUsername(),
                user.getPassword(),
                user.getEnabled() == null ? true : user.getEnabled(), // domylnie true jeli null
                true, // accountNonExpired
                true, // credentialsNonExpired
                true, // accountNonLocked
                getAuthorities(user.getRole())
        );
    }

    private Collection<? extends GrantedAuthority> getAuthorities(String role) {
        String authority = "ROLE_" + (role != null ? role : "USER");
        log.info("凤  Nadaj uprawnienie: {}", authority);
        return Collections.singletonList(new SimpleGrantedAuthority(authority));
    }
}


CIEKA: src\main\java\pl\komis\service\KlientPromocjaService.java
---------------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import pl.komis.model.Klient;
import pl.komis.model.KlientPromocja;
import pl.komis.model.Promocja;
import pl.komis.repository.KlientPromocjaRepository;
import pl.komis.repository.KlientRepository;
import pl.komis.repository.PromocjaRepository;

import java.util.List;

@Service
@RequiredArgsConstructor
public class KlientPromocjaService {

    private final KlientPromocjaRepository klientPromocjaRepository;
    private final KlientRepository klientRepository;
    private final PromocjaRepository promocjaRepository;

    public List<KlientPromocja> findAll() {
        return klientPromocjaRepository.findAll();
    }

    public KlientPromocja findById(Long id) {
        return klientPromocjaRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Nie znaleziono przypisania promocji o id=" + id));
    }

    public List<KlientPromocja> findByKlientId(Long klientId) {
        return klientPromocjaRepository.findByKlientId(klientId);
    }

    public List<KlientPromocja> findByPromocjaId(Long promocjaId) {
        return klientPromocjaRepository.findByPromocjaId(promocjaId);
    }

    // ============================
    //    NAJWA呕NIEJSZE METODY
    // ============================

    public KlientPromocja assignPromotion(Long idKlienta, Long idPromocji) {

        Klient klient = klientRepository.findById(idKlienta)
                .orElseThrow(() -> new RuntimeException("Klient nie istnieje: " + idKlienta));

        Promocja promocja = promocjaRepository.findById(idPromocji)
                .orElseThrow(() -> new RuntimeException("Promocja nie istnieje: " + idPromocji));

        // tworzymy przypisanie
        KlientPromocja kp = new KlientPromocja();
        kp.setKlient(klient);
        kp.setPromocja(promocja);

        return klientPromocjaRepository.save(kp);
    }

    public void remove(Long id) {
        if (!klientPromocjaRepository.existsById(id)) {
            throw new RuntimeException("Nie znaleziono przypisania do usunicia: " + id);
        }
        klientPromocjaRepository.deleteById(id);
    }
}


CIEKA: src\main\java\pl\komis\service\KlientService.java
-------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import pl.komis.model.Klient;
import pl.komis.repository.KlientRepository;

import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class KlientService {

    private final KlientRepository klientRepository;

    public List<Klient> findAll() {
        return klientRepository.findAll();
    }

    public Klient getById(Long id) {
        return klientRepository.findById(id)
                .orElseThrow(() -> new NoSuchElementException("Klient o id " + id + " nie istnieje."));
    }

    public Klient save(Klient klient) {
        return klientRepository.save(klient);
    }

    public void remove(Long id) {
        if (!klientRepository.existsById(id)) {
            throw new NoSuchElementException("Nie mo偶na usun  klient o id " + id + " nie istnieje.");
        }
        klientRepository.deleteById(id);
    }

    public Optional<Klient> findByEmail(String email) {
        return klientRepository.findByEmail(email);
    }
}



CIEKA: src\main\java\pl\komis\service\PracownikService.java
----------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import pl.komis.model.Pracownik;
import pl.komis.repository.PracownikRepository;

import java.util.List;
import java.util.NoSuchElementException;

@Service
@RequiredArgsConstructor
public class PracownikService {

    private final PracownikRepository pracownikRepository;

    public List<Pracownik> findAll() {
        return pracownikRepository.findAll();
    }

    public Pracownik getById(Long id) {
        return pracownikRepository.findById(id)
                .orElseThrow(() -> new NoSuchElementException("Pracownik o ID " + id + " nie istnieje"));
    }

    public Pracownik save(Pracownik pracownik) {
        return pracownikRepository.save(pracownik);
    }

    public void remove(Long id) {
        pracownikRepository.deleteById(id);
    }
}





CIEKA: src\main\java\pl\komis\service\PromocjaService.java
---------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import pl.komis.model.Promocja;
import pl.komis.repository.PromocjaRepository;

import java.time.LocalDate;
import java.util.List;
import java.util.NoSuchElementException;

@Service
@RequiredArgsConstructor
public class PromocjaService {

    private final PromocjaRepository promocjaRepository;

    public List<Promocja> findAll() {
        return promocjaRepository.findAll();
    }

    public Promocja getById(Long id) {
        return promocjaRepository.findById(id)
                .orElseThrow(() -> new NoSuchElementException("Promocja o id " + id + " nie istnieje."));
    }

    public Promocja save(Promocja promocja) {
        return promocjaRepository.save(promocja);
    }

    public Promocja update(Long id, Promocja data) {
        Promocja p = getById(id);

        p.setNazwa(data.getNazwa());
        p.setRodzaj(data.getRodzaj());
        p.setWartosc(data.getWartosc());
        p.setOpis(data.getOpis());
        p.setDataRozpoczecia(data.getDataRozpoczecia());
        p.setDataZakonczenia(data.getDataZakonczenia());
        p.setAktywna(data.getAktywna());

        return promocjaRepository.save(p);
    }

    public void remove(Long id) {
        if (!promocjaRepository.existsById(id)) {
            throw new NoSuchElementException("Promocja o id " + id + " nie istnieje.");
        }
        promocjaRepository.deleteById(id);
    }

    public List<Promocja> findActive() {
        LocalDate today = LocalDate.now();
        return promocjaRepository.findByDataRozpoczeciaBeforeAndDataZakonczeniaAfter(today, today);
    }
}



CIEKA: src\main\java\pl\komis\service\SamochodService.java
---------------------------------------------------------------
package pl.komis.service;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import pl.komis.model.Samochod;
import pl.komis.repository.SamochodRepository;

import java.math.BigDecimal;
import java.time.LocalDate;
import java.util.List;
import java.util.Map;
import java.util.Optional;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
@Transactional
public class SamochodService {

    private final SamochodRepository samochodRepository;

    // ==================== PODSTAWOWE OPERACJE CRUD PRZEZ PROCEDURY ====================

    @Transactional(readOnly = true)
    public List<Samochod> findAll() {
        return samochodRepository.findAll();
    }

    @Transactional(readOnly = true)
    public Optional<Samochod> findById(Long id) {
        return samochodRepository.findById(id);
    }

    @Transactional
    public Samochod save(Samochod samochod) {
        // Ustaw domylne wartoci jeli potrzebne
        if (samochod.getDataDodania() == null) {
            samochod.setDataDodania(LocalDate.now());
        }
        if (samochod.getRodzajPaliwa() == null) {
            samochod.setRodzajPaliwa("Benzyna");
        }
        if (samochod.getSkrzyniaBiegow() == null) {
            samochod.setSkrzyniaBiegow("Manualna");
        }
        if (samochod.getPojemnoscSilnika() == null) {
            samochod.setPojemnoscSilnika(2.0);
        }
        if (samochod.getStatus() == null) {
            samochod.setStatus("DOSTEPNY");
        }

        // Upewnij si, 偶e zdjecieUrl nie jest null
        String zdjecieUrl = samochod.getZdjecieUrl();
        if (zdjecieUrl == null) {
            zdjecieUrl = "";
        }

        if (samochod.getId() == null) {
            // Tworzenie nowego samochodu przez procedur
            Long newCarId = samochodRepository.createCar(
                    samochod.getMarka(),
                    samochod.getModel(),
                    samochod.getRokProdukcji(),
                    samochod.getPrzebieg(),
                    samochod.getPojemnoscSilnika(),
                    samochod.getRodzajPaliwa(),
                    samochod.getSkrzyniaBiegow(),
                    samochod.getKolor(),
                    samochod.getCena(),
                    samochod.getStatus(),
                    zdjecieUrl
            );

            return samochodRepository.findById(newCarId)
                    .orElseThrow(() -> new RuntimeException("Bd podczas tworzenia samochodu"));
        } else {
            // Aktualizacja istniejcego samochodu przez procedur
            samochodRepository.updateCar(
                    samochod.getId(),
                    samochod.getMarka(),
                    samochod.getModel(),
                    samochod.getRokProdukcji(),
                    samochod.getPrzebieg(),
                    samochod.getPojemnoscSilnika(),
                    samochod.getRodzajPaliwa(),
                    samochod.getSkrzyniaBiegow(),
                    samochod.getKolor(),
                    samochod.getCena(),
                    samochod.getStatus(),
                    zdjecieUrl
            );

            return samochodRepository.findById(samochod.getId())
                    .orElseThrow(() -> new RuntimeException("Bd podczas aktualizacji samochodu"));
        }
    }

    @Transactional
    public void delete(Long id) {
        if (!samochodRepository.existsById(id)) {
            throw new RuntimeException("Samoch贸d nie znaleziony");
        }
        // U偶ycie procedury usuwania
        samochodRepository.deleteCar(id);
    }

    // ==================== ZAAWANSOWANE WYSZUKIWANIE PRZEZ BEZPOREDNIE ZAPYTANIE SQL ====================

    @Transactional(readOnly = true)
    public List<Samochod> searchCars(SearchCriteria criteria) {
        // Upewnij si, 偶e puste stringi s traktowane jako null
        String marka = (criteria.getMarka() != null && !criteria.getMarka().trim().isEmpty()) ? criteria.getMarka() : null;
        String model = (criteria.getModel() != null && !criteria.getModel().trim().isEmpty()) ? criteria.getModel() : null;
        String status = (criteria.getStatus() != null && !criteria.getStatus().trim().isEmpty()) ? criteria.getStatus() : null;
        String rodzajPaliwa = (criteria.getRodzajPaliwa() != null && !criteria.getRodzajPaliwa().trim().isEmpty()) ? criteria.getRodzajPaliwa() : null;

        return samochodRepository.searchCars(
                marka,
                model,
                criteria.getMinRok(),
                criteria.getMaxRok(),
                criteria.getMinPrzebieg(),
                criteria.getMaxPrzebieg(),
                criteria.getMinCena(),
                criteria.getMaxCena(),
                rodzajPaliwa,
                status
        );
    }

    @Transactional(readOnly = true)
    public List<Samochod> searchCarsSimple(String marka, String model, String status) {
        // Upewnij si, 偶e puste stringi s traktowane jako null
        String searchMarka = (marka != null && !marka.trim().isEmpty()) ? marka : null;
        String searchModel = (model != null && !model.trim().isEmpty()) ? model : null;
        String searchStatus = (status != null && !status.trim().isEmpty()) ? status : null;

        return samochodRepository.searchCarsSimple(searchMarka, searchModel, searchStatus);
    }

    // ==================== OPERACJE BIZNESOWE PRZEZ PROCEDURY ====================

    @Transactional
    public Map<String, Object> reserveCar(Long carId, Long userId) {
        try {
            return samochodRepository.reserveCar(carId, userId);
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas rezerwacji samochodu: " + e.getMessage());
        }
    }

    @Transactional
    public Map<String, Object> sellCar(Long carId, Long userId, Long employeeId, BigDecimal finalPrice) {
        try {
            return samochodRepository.sellCar(carId, userId, employeeId, finalPrice);
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas sprzeda偶y samochodu: " + e.getMessage());
        }
    }

    @Transactional
    public Map<String, Object> cancelReservation(Long carId) {
        try {
            return samochodRepository.cancelReservation(carId);
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas anulowania rezerwacji: " + e.getMessage());
        }
    }

    // ==================== RAPORTY I STATYSTYKI PRZEZ FUNKCJE ====================

    @Transactional(readOnly = true)
    public List<Samochod> getAvailableCars() {
        try {
            List<Object[]> results = samochodRepository.getAvailableCars();
            return results.stream()
                    .map(this::mapToSamochodFromArray)
                    .collect(Collectors.toList());
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas pobierania dostpnych samochod贸w: " + e.getMessage());
        }
    }

    @Transactional(readOnly = true)
    public CarStatistics getCarStatistics() {
        try {
            Map<String, Object> stats = samochodRepository.getCarStatistics();
            return new CarStatistics(
                    ((Number) stats.get("total_cars")).longValue(),
                    ((Number) stats.get("available_cars")).longValue(),
                    ((Number) stats.get("sold_cars")).longValue(),
                    ((Number) stats.get("reserved_cars")).longValue(),
                    (BigDecimal) stats.get("avg_price")
            );
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas pobierania statystyk: " + e.getMessage());
        }
    }

    @Transactional(readOnly = true)
    public List<BrandStatistics> getTopBrands(Integer limitCount) {
        try {
            List<Object[]> results = samochodRepository.getTopBrands(limitCount != null ? limitCount : 5);
            return results.stream()
                    .map(this::mapToBrandStatistics)
                    .collect(Collectors.toList());
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas pobierania top marek: " + e.getMessage());
        }
    }

    @Transactional(readOnly = true)
    public List<MonthlySales> getMonthlySalesReport(Integer year, Integer month) {
        try {
            List<Object[]> results = samochodRepository.getMonthlySalesReport(year, month);
            return results.stream()
                    .map(this::mapToMonthlySales)
                    .collect(Collectors.toList());
        } catch (Exception e) {
            throw new RuntimeException("Bd podczas pobierania raportu sprzeda偶y: " + e.getMessage());
        }
    }

    // ==================== METODY POMOCNICZE ====================

    @Transactional(readOnly = true)
    public List<Samochod> findByMarka(String marka) {
        return samochodRepository.findByMarkaIgnoreCase(marka);
    }

    @Transactional(readOnly = true)
    public List<Samochod> findByModel(String model) {
        return samochodRepository.findByModelIgnoreCase(model);
    }

    @Transactional(readOnly = true)
    public List<Samochod> findByStatus(String status) {
        return samochodRepository.findByStatus(status);
    }

    @Transactional(readOnly = true)
    public List<Samochod> findByCenaBetween(BigDecimal min, BigDecimal max) {
        return samochodRepository.findByCenaBetween(min, max);
    }

    @Transactional(readOnly = true)
    public List<Samochod> findByCenaBetween(double min, double max) {
        BigDecimal minCena = BigDecimal.valueOf(min);
        BigDecimal maxCena = BigDecimal.valueOf(max);
        return samochodRepository.findByCenaBetween(minCena, maxCena);
    }

    @Transactional(readOnly = true)
    public long count() {
        return samochodRepository.count();
    }

    @Transactional(readOnly = true)
    public long countByStatus(String status) {
        return samochodRepository.findByStatus(status).size();
    }

    @Transactional(readOnly = true)
    public List<Samochod> findAvailableCars() {
        return samochodRepository.findByStatus("DOSTEPNY");
    }

    @Transactional(readOnly = true)
    public List<Samochod> findSoldCars() {
        return samochodRepository.findByStatus("SPRZEDANY");
    }

    @Transactional(readOnly = true)
    public List<Samochod> findReservedCars() {
        return samochodRepository.findByStatus("ZAREZERWOWANY");
    }

    @Transactional(readOnly = true)
    public boolean existsById(Long id) {
        return samochodRepository.existsById(id);
    }

    @Transactional
    public Samochod updateStatus(Long id, String newStatus) {
        Samochod samochod = samochodRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Samoch贸d nie znaleziony"));

        samochodRepository.updateCar(
                samochod.getId(),
                samochod.getMarka(),
                samochod.getModel(),
                samochod.getRokProdukcji(),
                samochod.getPrzebieg(),
                samochod.getPojemnoscSilnika(),
                samochod.getRodzajPaliwa(),
                samochod.getSkrzyniaBiegow(),
                samochod.getKolor(),
                samochod.getCena(),
                newStatus,
                samochod.getZdjecieUrl()
        );

        return samochodRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Bd podczas aktualizacji statusu samochodu"));
    }

    @Transactional(readOnly = true)
    public List<String> findAllMarki() {
        return samochodRepository.findAll().stream()
                .map(Samochod::getMarka)
                .distinct()
                .collect(Collectors.toList());
    }

    // ==================== METODY MAPUJCE ====================

    private Samochod mapToSamochodFromArray(Object[] result) {
        Samochod samochod = new Samochod();
        samochod.setId(((Number) result[0]).longValue());
        samochod.setMarka((String) result[1]);
        samochod.setModel((String) result[2]);
        samochod.setRokProdukcji(((Number) result[3]).intValue());
        samochod.setCena((BigDecimal) result[4]);
        samochod.setStatus((String) result[5]);
        return samochod;
    }

    private BrandStatistics mapToBrandStatistics(Object[] result) {
        return new BrandStatistics(
                (String) result[0],
                ((Number) result[1]).longValue(),
                (BigDecimal) result[2]
        );
    }

    private MonthlySales mapToMonthlySales(Object[] result) {
        return new MonthlySales(
                ((java.sql.Date) result[0]).toLocalDate(),
                (String) result[1],
                (String) result[2],
                (BigDecimal) result[3],
                (String) result[4],
                (String) result[5]
        );
    }

    // ==================== KLASY POMOCNICZE ====================

    @Data
    public static class SearchCriteria {
        private String marka;
        private String model;
        private Integer minRok;
        private Integer maxRok;
        private Integer minPrzebieg;
        private Integer maxPrzebieg;
        private BigDecimal minCena;
        private BigDecimal maxCena;
        private String rodzajPaliwa;
        private String status;
    }

    @Data
    @AllArgsConstructor
    public static class CarStatistics {
        private Long totalCars;
        private Long availableCars;
        private Long soldCars;
        private Long reservedCars;
        private BigDecimal avgPrice;
    }

    @Data
    @AllArgsConstructor
    public static class BrandStatistics {
        private String marka;
        private Long carCount;
        private BigDecimal avgPrice;
    }

    @Data
    @AllArgsConstructor
    public static class MonthlySales {
        private LocalDate dataZakupu;
        private String marka;
        private String model;
        private BigDecimal cenaZakupu;
        private String klient;
        private String pracownik;
    }
}


CIEKA: src\main\java\pl\komis\service\UserService.java
-----------------------------------------------------------
package pl.komis.service;

import lombok.Getter;
import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import pl.komis.model.User;
import pl.komis.repository.UserRepository;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    // ==================== METODY REJESTRACJI I TWORZENIA ====================

    public User registerUser(User user, String rawPassword) {
        if (userRepository.existsByUsername(user.getUsername())) {
            throw new RuntimeException("Nazwa u偶ytkownika jest ju偶 zajta");
        }
        if (userRepository.existsByEmail(user.getEmail())) {
            throw new RuntimeException("Email jest ju偶 zajty");
        }

        String encodedPassword = passwordEncoder.encode(rawPassword);
        String role = user.getRole() != null ? user.getRole() : "USER";

        // U偶ycie procedury zamiast standardowego save
        Long newUserId = userRepository.createUser(
                user.getUsername(),
                user.getEmail(),
                encodedPassword,
                role,
                true
        );

        // Pobierz utworzonego u偶ytkownika
        return userRepository.findById(newUserId)
                .orElseThrow(() -> new RuntimeException("Bd podczas tworzenia u偶ytkownika"));
    }

    public User createUserByAdmin(User user, String rawPassword, String role) {
        if (userRepository.existsByUsername(user.getUsername())) {
            throw new RuntimeException("Nazwa u偶ytkownika jest ju偶 zajta");
        }
        if (userRepository.existsByEmail(user.getEmail())) {
            throw new RuntimeException("Email jest ju偶 zajty");
        }

        String encodedPassword = passwordEncoder.encode(rawPassword);

        // U偶ycie procedury tworzenia u偶ytkownika
        Long newUserId = userRepository.createUser(
                user.getUsername(),
                user.getEmail(),
                encodedPassword,
                role,
                true
        );

        return userRepository.findById(newUserId)
                .orElseThrow(() -> new RuntimeException("Bd podczas tworzenia u偶ytkownika"));
    }

    public User createUser(User user, String rawPassword) {
        if (userRepository.existsByUsername(user.getUsername())) {
            throw new RuntimeException("Nazwa u偶ytkownika jest ju偶 zajta");
        }
        if (userRepository.existsByEmail(user.getEmail())) {
            throw new RuntimeException("Email jest ju偶 zajty");
        }

        String encodedPassword = passwordEncoder.encode(rawPassword);
        String role = user.getRole() != null ? user.getRole() : "USER";

        // U偶ycie procedury tworzenia u偶ytkownika
        Long newUserId = userRepository.createUser(
                user.getUsername(),
                user.getEmail(),
                encodedPassword,
                role,
                true
        );

        return userRepository.findById(newUserId)
                .orElseThrow(() -> new RuntimeException("Bd podczas tworzenia u偶ytkownika"));
    }

    // ==================== METODY ODCZYTU ====================

    public List<User> findAll() {
        return userRepository.findAll();
    }

    public List<User> findAllUsers() {
        return userRepository.findAll();
    }

    public Optional<User> findById(Long id) {
        return userRepository.findById(id);
    }

    public Optional<User> findUserById(Long id) {
        return userRepository.findById(id);
    }

    public Optional<User> findByUsername(String username) {
        return userRepository.findByUsername(username);
    }

    public Optional<User> findByEmail(String email) {
        return userRepository.findByEmail(email);
    }

    // ==================== METODY AKTUALIZACJI ====================

    public User updateUser(User user) {
        // Sprawd藕 czy u偶ytkownik istnieje
        User existingUser = userRepository.findById(user.getId())
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        // Sprawd藕 unikalno username (jeli si zmieni)
        if (!existingUser.getUsername().equals(user.getUsername()) &&
                userRepository.existsByUsername(user.getUsername())) {
            throw new RuntimeException("Nazwa u偶ytkownika jest ju偶 zajta");
        }

        // Sprawd藕 unikalno email (jeli si zmieni)
        if (!existingUser.getEmail().equals(user.getEmail()) &&
                userRepository.existsByEmail(user.getEmail())) {
            throw new RuntimeException("Email jest ju偶 zajty");
        }

        // Zachowaj haso jeli nie zostao zmienione
        String password = user.getPassword();
        if (password == null || password.isEmpty()) {
            password = existingUser.getPassword();
        } else {
            // Jeli podano nowe haso, zakoduj je
            password = passwordEncoder.encode(password);
        }

        // U偶ycie procedury aktualizacji
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                password,
                user.getRole(),
                user.getEnabled() != null ? user.getEnabled() : true
        );

        return userRepository.findById(user.getId())
                .orElseThrow(() -> new RuntimeException("Bd podczas aktualizacji u偶ytkownika"));
    }

    public User changePassword(Long userId, String newPassword) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        String encodedPassword = passwordEncoder.encode(newPassword);

        // U偶ycie procedury aktualizacji z nowym hasem
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                encodedPassword,
                user.getRole(),
                user.getEnabled()
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas zmiany hasa"));
    }

    public User toggleUserStatus(Long userId) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        boolean newStatus = !user.getEnabled();

        // U偶ycie procedury aktualizacji statusu
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                user.getPassword(),
                user.getRole(),
                newStatus
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas zmiany statusu u偶ytkownika"));
    }

    public User activateUser(Long userId) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        // U偶ycie procedury aktualizacji - aktywacja
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                user.getPassword(),
                user.getRole(),
                true
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas aktywacji u偶ytkownika"));
    }

    public User deactivateUser(Long userId) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        // U偶ycie procedury aktualizacji - deaktywacja
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                user.getPassword(),
                user.getRole(),
                false
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas deaktywacji u偶ytkownika"));
    }

    public User changeUserRole(Long userId, String newRole) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        // U偶ycie procedury aktualizacji roli
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                user.getPassword(),
                newRole,
                user.getEnabled()
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas zmiany roli u偶ytkownika"));
    }

    // ==================== METODY USUWANIA ====================

    public void deleteUser(Long id) {
        if (!userRepository.existsById(id)) {
            throw new RuntimeException("U偶ytkownik nie znaleziony");
        }
        // U偶ycie procedury usuwania
        userRepository.deleteUser(id);
    }

    public void deleteUserByUsername(String username) {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));
        // U偶ycie procedury usuwania
        userRepository.deleteUser(user.getId());
    }

    // ==================== METODY WALIDACJI I SPRAWDZANIA ====================

    public boolean usernameExists(String username) {
        return userRepository.existsByUsername(username);
    }

    public boolean emailExists(String email) {
        return userRepository.existsByEmail(email);
    }

    public boolean existsById(Long id) {
        return userRepository.existsById(id);
    }

    public long count() {
        return userRepository.count();
    }

    public long countByRole(String role) {
        return userRepository.findAll().stream()
                .filter(user -> role.equals(user.getRole()))
                .count();
    }

    public long countActiveUsers() {
        return userRepository.findAll().stream()
                .filter(User::getEnabled)
                .count();
    }

    public long countInactiveUsers() {
        return userRepository.findAll().stream()
                .filter(user -> !user.getEnabled())
                .count();
    }

    // ==================== METODY SPECJALNE ====================

    public List<User> findByRole(String role) {
        return userRepository.findAll().stream()
                .filter(user -> role.equals(user.getRole()))
                .collect(Collectors.toList());
    }

    public List<User> findActiveUsers() {
        return userRepository.findAll().stream()
                .filter(User::getEnabled)
                .collect(Collectors.toList());
    }

    public List<User> findInactiveUsers() {
        return userRepository.findAll().stream()
                .filter(user -> !user.getEnabled())
                .collect(Collectors.toList());
    }

    public List<User> findAdmins() {
        return findByRole("ADMIN");
    }

    public List<User> findUsers() {
        return findByRole("USER");
    }

    public boolean isUserActive(Long userId) {
        return userRepository.findById(userId)
                .map(User::getEnabled)
                .orElse(false);
    }

    public boolean isUserAdmin(Long userId) {
        return userRepository.findById(userId)
                .map(user -> "ADMIN".equals(user.getRole()))
                .orElse(false);
    }

    public boolean isUserRegular(Long userId) {
        return userRepository.findById(userId)
                .map(user -> "USER".equals(user.getRole()))
                .orElse(false);
    }

    // ==================== METODY POMOCNICZE ====================

    public void validateUserCredentials(String username, String password) {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        if (!passwordEncoder.matches(password, user.getPassword())) {
            throw new RuntimeException("Nieprawidowe haso");
        }
    }

    public boolean verifyPassword(Long userId, String rawPassword) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        return passwordEncoder.matches(rawPassword, user.getPassword());
    }

    public User resetPassword(Long userId, String newPassword) {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("U偶ytkownik nie znaleziony"));

        String encodedPassword = passwordEncoder.encode(newPassword);

        // U偶ycie procedury aktualizacji hasa
        userRepository.updateUser(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                encodedPassword,
                user.getRole(),
                user.getEnabled()
        );

        return userRepository.findById(userId)
                .orElseThrow(() -> new RuntimeException("Bd podczas resetowania hasa"));
    }

    // ==================== METODY RAPORTOWANIA ====================

    public UserStatistics getUserStatistics() {
        long totalUsers = count();
        long activeUsers = countActiveUsers();
        long inactiveUsers = countInactiveUsers();
        long adminUsers = countByRole("ADMIN");
        long regularUsers = countByRole("USER");

        return new UserStatistics(totalUsers, activeUsers, inactiveUsers, adminUsers, regularUsers);
    }

    // Klasa pomocnicza dla statystyk
    @Getter
    public static class UserStatistics {
        // Gettery
        private final long totalUsers;
        private final long activeUsers;
        private final long inactiveUsers;
        private final long adminUsers;
        private final long regularUsers;

        public UserStatistics(long totalUsers, long activeUsers, long inactiveUsers, long adminUsers, long regularUsers) {
            this.totalUsers = totalUsers;
            this.activeUsers = activeUsers;
            this.inactiveUsers = inactiveUsers;
            this.adminUsers = adminUsers;
            this.regularUsers = regularUsers;
        }

    }
}


CIEKA: src\main\java\pl\komis\service\ZakupService.java
------------------------------------------------------------
package pl.komis.service;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import pl.komis.model.Zakup;
import pl.komis.repository.ZakupRepository;

import java.time.LocalDate;
import java.util.List;
import java.util.NoSuchElementException;

@Service
@RequiredArgsConstructor
public class ZakupService {

    private final ZakupRepository zakupRepository;

    public List<Zakup> findAll() {
        return zakupRepository.findAll();
    }

    public Zakup getById(Long id) {
        return zakupRepository.findById(id)
                .orElseThrow(() -> new NoSuchElementException("Zakup o ID " + id + " nie istnieje"));
    }

    public Zakup save(Zakup zakup) {
        return zakupRepository.save(zakup);
    }

    public void remove(Long id) {
        zakupRepository.deleteById(id);
    }

    public List<Zakup> findByKlientId(Long id) {
        return zakupRepository.findByKlientId(id);
    }

    public List<Zakup> findByPracownikId(Long id) {
        return zakupRepository.findByPracownikId(id);
    }

    public List<Zakup> findByDateRange(LocalDate od, LocalDate do_) {
        return zakupRepository.findByDataZakupuBetween(od, do_);
    }
}



CIEKA: src\main\resources\application.yml
----------------------------------------------
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/komis
    username: postgres
    password: student
    driver-class-name: org.postgresql.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    database-platform: org.hibernate.dialect.PostgreSQLDialect

server:
  port: 8080


CIEKA: src\main\resources\templates\error.html
---------------------------------------------------
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bd</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1>Wystpi bd</h1>
    <p>Przepraszamy, wystpi problem z aplikacj.</p>
    <a href="/" class="btn btn-primary">Powr贸t do strony g贸wnej</a>
</div>
</body>
</html>


CIEKA: src\main\resources\templates\index.html
---------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Komis Samochodowy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .car-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px 5px 0 0;
        }
        .no-card-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            border-radius: 5px 5px 0 0;
        }
        .car-card {
            transition: transform 0.2s ease-in-out;
            height: 100%;
        }
        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <a class="nav-link" href="/search">
                    <i class="fas fa-search me-1"></i> Zaawansowane wyszukiwanie
                </a>
                <div sec:authorize="hasRole('ADMIN')" class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                        <li><a class="dropdown-item" href="/zakupy">Zakupy</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <div sec:authorize="isAuthenticated()">
                    <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                    <a class="nav-link" href="#" th:href="@{/logout}">Wyloguj</a>
                </div>
                <div sec:authorize="!isAuthenticated()">
                    <a class="nav-link" href="/login">Zaloguj</a>
                    <a class="nav-link" href="/register">Rejestracja</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Komunikat o wylogowaniu -->
    <div th:if="${param.logout}" class="alert alert-success alert-dismissible fade show" role="alert">
        Zostae pomylnie wylogowany!
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="row align-items-center mb-5">
        <div class="col-md-8">
            <h1> Komis Samochodowy</h1>
            <p class="lead mb-0">Witamy w naszym komisie! Przegldaj nasz ofert samochod贸w z penymi szczeg贸ami technicznymi.</p>
        </div>
        <div class="col-md-4 text-end">
            <a th:href="@{/samochody}" class="btn btn-primary btn-lg">
                <i class="fas fa-car"></i> Zobacz wszystkie samochody
            </a>

            <!-- Przyciski tylko dla admina -->
            <div sec:authorize="hasRole('ADMIN')">
                <a th:href="@{/klienci}" class="btn btn-secondary btn-lg ms-2">
                    <i class="fas fa-users"></i> Klienci
                </a>
                <a th:href="@{/pracownicy}" class="btn btn-secondary btn-lg ms-2">
                    <i class="fas fa-user-tie"></i> Pracownicy
                </a>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h3 class="card-title"> Najlepsze oferty w miecie!</h3>
                    <p class="card-text mb-0">
                        Sprawd藕 nasz aktualn ofert. Ka偶dy samoch贸d przeszed szczeg贸ow kontrol techniczn.<br>
                        <strong>Zaloguj si, aby zobaczy pene szczeg贸y i zarezerwowa wybrany model.</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <h2 class="mb-4 text-center"> Ostatnio dodane</h2>
    <div class="row">
        <div th:each="samochod : ${samochody}" class="col-lg-4 col-md-6 mb-4">
            <div class="card car-card h-100">
                <!-- Zdjcie samochodu -->
                <div class="position-relative">
                    <div th:if="${samochod.zdjecieUrl != null and samochod.zdjecieUrl != ''}">
                        <img th:src="${samochod.zdjecieUrl}"
                             th:alt="${samochod.marka + ' ' + samochod.model}"
                             class="car-card-image">
                    </div>
                    <div th:if="${samochod.zdjecieUrl == null or samochod.zdjecieUrl == ''}" class="no-card-image">
                        <i class="fas fa-car"></i>
                    </div>

                    <!-- Status badge -->
                    <span th:if="${samochod.status == 'DOSTEPNY'}"
                          class="badge bg-success status-badge" th:text="${samochod.status}"></span>
                    <span th:if="${samochod.status == 'SPRZEDANY'}"
                          class="badge bg-danger status-badge" th:text="${samochod.status}"></span>
                    <span th:if="${samochod.status == 'ZAREZERWOWANY'}"
                          class="badge bg-warning status-badge" th:text="${samochod.status}"></span>
                </div>

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title" th:text="${samochod.marka + ' ' + samochod.model}"></h5>

                    <div class="row mb-2">
                        <div class="col-6">
                            <small class="text-muted">Rok:</small><br>
                            <strong th:text="${samochod.rokProdukcji}"></strong>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">Przebieg:</small><br>
                            <strong th:text="${#numbers.formatInteger(samochod.przebieg, 0, 'COMMA') + ' km'}"></strong>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-12">
                            <small class="text-muted">Paliwo:</small><br>
                            <strong th:text="${samochod.rodzajPaliwa}"></strong>
                        </div>
                    </div>

                    <div class="mt-auto">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="h4 text-success mb-0"
                                      th:text="${#numbers.formatDecimal(samochod.cena, 0, 'COMMA', 2, 'POINT') + ' z'}"></span>
                        </div>

                        <!-- Przyciski akcji -->
                        <div sec:authorize="isAuthenticated()" class="d-grid">
                            <a th:href="@{/samochody/szczegoly(id=${samochod.id})}"
                               class="btn btn-outline-primary">
                                <i class="fas fa-search"></i> Zobacz szczeg贸y
                            </a>
                        </div>

                        <div sec:authorize="!isAuthenticated()" class="d-grid">
                            <a th:href="@{/samochody/szczegoly(id=${samochod.id})}"
                               class="btn btn-outline-primary">
                                <i class="fas fa-search"></i> Zobacz szczeg贸y
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${samochody.empty}" class="alert alert-info text-center">
        <i class="fas fa-info-circle fa-2x mb-3"></i><br>
        Brak samochod贸w w ofercie. Sprawd藕 p贸藕niej!
    </div>

    <!-- Informacja o koniecznoci logowania - POKAZUJ TYLKO DLA NIEZALOGOWANYCH -->
    <div th:if="${not isAuthenticated}" class="row mt-5">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <h4 class="text-warning"><i class="fas fa-exclamation-triangle"></i> Wa偶na informacja</h4>
                    <p class="mb-0">
                        Aby zobaczy pene szczeg贸y techniczne, zdjcia w wysokiej rozdzielczoci
                        oraz m贸c rezerwowa i kupowa samochody, <strong>musisz si zalogowa</strong>.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal z informacj o koniecznoci logowania -->
<div class="modal fade" id="loginInfoModal" tabindex="-1" aria-labelledby="loginInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginInfoModalLabel">
                    <i class="fas fa-info-circle text-primary"></i> Informacja
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Aby zobaczy pene szczeg贸y tego samochodu, musisz si zalogowa.</p>
                <div class="alert alert-info">
                    <strong>Po zalogowaniu bdziesz m贸g:</strong>
                    <ul class="mb-0 mt-2">
                        <li>Zobaczy wszystkie parametry techniczne</li>
                        <li>Obejrze zdjcia w wysokiej rozdzielczoci</li>
                        <li>Zarezerwowa wybrany samoch贸d</li>
                        <li>Skontaktowa si w sprawie zakupu</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">P贸藕niej</button>
                <a href="/login" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Przejd藕 do logowania
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\klienci.html
-----------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Lista Klient贸w</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <div class="navbar-nav">
            <div sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" th:href="@{/klienci}">Klienci</a>
                <a class="nav-link" th:href="@{/pracownicy}">Pracownicy</a>
            </div>
        </div>

        <div class="navbar-nav ms-auto">
            <div sec:authorize="isAuthenticated()">
                <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                <a class="nav-link d-inline" href="#" th:href="@{/logout}">Wyloguj</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4 text-center" th:text="${tytul}">Lista Klient贸w</h1>

    <div th:if="${klienci.empty}" class="alert alert-info text-center">
        Brak klient贸w w bazie danych.
    </div>

    <table th:if="${!klienci.empty}" class="table table-striped">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Nazwa u偶ytkownika</th>
            <th>Email</th>
            <th>Rola</th>
            <th>Status</th>
            <th>Data utworzenia</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="klient : ${klienci}">
            <td th:text="${klient.id}"></td>
            <td th:text="${klient.username}"></td>
            <td th:text="${klient.email}"></td>
            <td>
                <span th:if="${klient.role == 'USER'}" class="badge bg-primary" th:text="${klient.role}"></span>
                <span th:if="${klient.role == 'ADMIN'}" class="badge bg-success" th:text="${klient.role}"></span>
            </td>
            <td>
                <span th:if="${klient.enabled}" class="badge bg-success">Aktywny</span>
                <span th:if="${!klient.enabled}" class="badge bg-danger">Nieaktywny</span>
            </td>
            <td th:text="${klient.createdAt}"></td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\login.html
---------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Logowanie - Komis Samochodowy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .brand-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .brand-header h2 {
            color: #333;
            margin-bottom: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/register">Zarejestruj si</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="login-container">
        <div class="brand-header">
            <h2> Komis Samochodowy</h2>
            <p class="text-muted">Zaloguj si do swojego konta</p>
        </div>

        <!-- Komunikat sukcesu (np. po rejestracji) -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle"></i>
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Komunikat o wylogowaniu -->
        <div th:if="${param.logout}" class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="fas fa-info-circle"></i>
            Zostae pomylnie wylogowany!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Komunikat o bdzie logowania -->
        <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            Nieprawidowa nazwa u偶ytkownika lub haso!
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <form th:action="@{/login}" method="post">
            <div class="mb-3">
                <label for="username" class="form-label">
                    <i class="fas fa-user"></i> Nazwa u偶ytkownika:
                </label>
                <input type="text" class="form-control" id="username" name="username"
                       placeholder="Wprowad藕 nazw u偶ytkownika" required
                       th:classappend="${param.error != null} ? 'is-invalid' : ''">
                <div class="invalid-feedback" th:if="${param.error}">
                    Sprawd藕 poprawno nazwy u偶ytkownika
                </div>
            </div>

            <div class="mb-3">
                <label for="password" class="form-label">
                    <i class="fas fa-lock"></i> Haso:
                </label>
                <input type="password" class="form-control" id="password" name="password"
                       placeholder="Wprowad藕 haso" required
                       th:classappend="${param.error != null} ? 'is-invalid' : ''">
                <div class="invalid-feedback" th:if="${param.error}">
                    Sprawd藕 poprawno hasa
                </div>
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="rememberMe" name="remember-me">
                <label class="form-check-label" for="rememberMe">Zapamitaj mnie</label>
            </div>

            <button type="submit" class="btn btn-primary w-100 btn-lg">
                <i class="fas fa-sign-in-alt"></i> Zaloguj si
            </button>
        </form>

        <div class="mt-4 text-center">
            <p class="mb-3">Nie masz konta?</p>
            <a href="/register" class="btn btn-outline-primary w-100">
                <i class="fas fa-user-plus"></i> Zarejestruj si
            </a>
        </div>

        <hr class="my-4">

        <div class="text-center">
            <small class="text-muted">
                <strong>Dane testowe:</strong><br>
                <strong>admin/admin</strong> - peny dostp administracyjny<br>
                <strong>user/user</strong> - podstawowy dostp u偶ytkownika
            </small>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Dodanie animacji dla p贸l formularza
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('input[type="text"], input[type="password"]');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
            });
            input.addEventListener('blur', function() {
                if (this.value === '') {
                    this.parentElement.classList.remove('focused');
                }
            });
        });
    });
</script>
</body>
</html>


CIEKA: src\main\resources\templates\password-generator.html
----------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Generator Hase BCrypt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1> Generator Hase BCrypt</h1>

    <div class="card mt-4">
        <div class="card-body">
            <form method="get" action="/generate">
                <div class="mb-3">
                    <label for="password" class="form-label">Haso do zakodowania:</label>
                    <input type="text" class="form-control" id="password" name="password"
                           placeholder="Wprowad藕 haso" required>
                </div>
                <button type="submit" class="btn btn-primary">Generuj BCrypt</button>
            </form>
        </div>
    </div>

    <div th:if="${encodedPassword}" class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">Wynik:</h5>
            <p><strong>Haso:</strong> <span th:text="${rawPassword}"></span></p>
            <p><strong>Zakodowane BCrypt:</strong> <code th:text="${encodedPassword}"></code></p>
            <p><strong>Zapytanie SQL:</strong></p>
            <pre class="bg-light p-3"><code th:text="${sqlUpdate}"></code></pre>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-body">
            <h5 class="card-title">Przykadowe hasa:</h5>
            <ul>
                <li><a href="/generate?password=admin">admin</a></li>
                <li><a href="/generate?password=user">user</a></li>
                <li><a href="/generate?password=testowy">testowy</a></li>
            </ul>
        </div>
    </div>
</div>
</body>
</html>


CIEKA: src\main\resources\templates\pracownicy.html
--------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Lista Pracownik贸w</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <div class="navbar-nav">
            <div sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" th:href="@{/klienci}">Klienci</a>
                <a class="nav-link" th:href="@{/pracownicy}">Pracownicy</a>
            </div>
        </div>

        <div class="navbar-nav ms-auto">
            <div sec:authorize="isAuthenticated()">
                <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                <a class="nav-link d-inline" href="#" th:href="@{/logout}">Wyloguj</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4 text-center" th:text="${tytul}">Lista Pracownik贸w</h1>

    <div th:if="${pracownicy.empty}" class="alert alert-info text-center">
        <i class="fas fa-info-circle"></i> Brak pracownik贸w w systemie.
    </div>

    <div th:if="${!pracownicy.empty}">
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nazwa u偶ytkownika</th>
                <th>Email</th>
                <th>Rola</th>
                <th>Status</th>
                <th>Data utworzenia</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="pracownik : ${pracownicy}">
                <td th:text="${pracownik.id}"></td>
                <td th:text="${pracownik.username}"></td>
                <td th:text="${pracownik.email}"></td>
                <td>
                    <span class="badge bg-success" th:text="${pracownik.role}"></span>
                </td>
                <td>
                    <span th:if="${pracownik.enabled}" class="badge bg-success">Aktywny</span>
                    <span th:if="${!pracownik.enabled}" class="badge bg-danger">Nieaktywny</span>
                </td>
                <td th:text="${pracownik.createdAt}"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\register.html
------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Rejestracja - Komis Samochodowy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .register-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/login">Zaloguj</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="register-container">
        <h2 class="text-center mb-4"> Rejestracja</h2>

        <!-- Komunikat sukcesu -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Komunikat bdu -->
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <form th:action="@{/register}" th:object="${registerRequest}" method="post">
            <div class="mb-3">
                <label for="username" class="form-label">Nazwa u偶ytkownika *</label>
                <input type="text" class="form-control" id="username"
                       th:field="*{username}" required minlength="3" maxlength="50">
                <div class="form-text">Minimum 3 znaki</div>
                <div th:if="${#fields.hasErrors('username')}" class="text-danger">
                    <span th:errors="*{username}"></span>
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email *</label>
                <input type="email" class="form-control" id="email"
                       th:field="*{email}" required>
                <div th:if="${#fields.hasErrors('email')}" class="text-danger">
                    <span th:errors="*{email}"></span>
                </div>
            </div>

            <div class="mb-3">
                <label for="password" class="form-label">Haso *</label>
                <input type="password" class="form-control" id="password"
                       th:field="*{password}" required minlength="6">
                <div class="form-text">Minimum 6 znak贸w</div>
                <div th:if="${#fields.hasErrors('password')}" class="text-danger">
                    <span th:errors="*{password}"></span>
                </div>
            </div>

            <div class="mb-3">
                <label for="confirmPassword" class="form-label">Potwierd藕 haso *</label>
                <input type="password" class="form-control" id="confirmPassword"
                       th:field="*{confirmPassword}" required>
                <div th:if="${#fields.hasErrors('confirmPassword')}" class="text-danger">
                    <span th:errors="*{confirmPassword}"></span>
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100 btn-lg">Zarejestruj si</button>
        </form>

        <div class="mt-3 text-center">
            <p>Masz ju偶 konto? <a href="/login">Zaloguj si</a></p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\samochody.html
-------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista Samochod贸w - Komis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h1>Lista Samochod贸w</h1>
    <a href="/" class="btn btn-secondary mb-3"> Powr贸t do strony g贸wnej</a>

    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>ID</th>
                <th>Marka</th>
                <th>Model</th>
                <th>Rok</th>
                <th>Cena</th>
                <th>Kolor</th>
                <th>Przebieg</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="samochod : ${samochody}">
                <td th:text="${samochod.id}"></td>
                <td th:text="${samochod.marka}"></td>
                <td th:text="${samochod.model}"></td>
                <td th:text="${samochod.rokProdukcji}"></td>
                <td th:text="${samochod.cena + ' z'}"></td>
                <td th:text="${samochod.kolor}"></td>
                <td th:text="${samochod.przebieg + ' km'}"></td>
                <td>
                            <span th:if="${samochod.status == 'DOSTEPNY'}"
                                  class="badge bg-success" th:text="${samochod.status}"></span>
                    <span th:if="${samochod.status == 'SPRZEDANY'}"
                          class="badge bg-danger" th:text="${samochod.status}"></span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>


CIEKA: src\main\resources\templates\zakupy_form.html
---------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Formularz zakupu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<div class="container mt-4">

    <h1 th:text="${zakup.id == null ? 'Dodaj zakup' : 'Edytuj zakup'}"></h1>

    <form th:action="@{${zakup.id == null} ? '/zakupy/dodaj' : '/zakupy/edytuj/' + ${zakup.id}}"
          th:object="${zakup}" method="post">

        <div class="mb-3">
            <label class="form-label">Samoch贸d</label>
            <select class="form-select" th:field="*{samochod}">
                <option th:each="s : ${samochody}"
                        th:value="${s}"
                        th:text="${s.marka + ' ' + s.model}">
                </option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Klient</label>
            <select class="form-select" th:field="*{klient}">
                <option th:each="k : ${klienci}"
                        th:value="${k}"
                        th:text="${k.imie + ' ' + k.nazwisko}">
                </option>
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Pracownik</label>
            <select class="form-select" th:field="*{pracownik}">
                <option th:each="p : ${pracownicy}"
                        th:value="${p}"
                        th:text="${p.imie + ' ' + p.nazwisko}">
                </option>
            </select>
        </div>

        <div class="mb-3">
            <label>Data zakupu</label>
            <input type="date" class="form-control" th:field="*{dataZakupu}">
        </div>

        <div class="mb-3">
            <label>Cena zakupu</label>
            <input type="number" step="0.01" class="form-control" th:field="*{cenaZakupu}">
        </div>

        <button type="submit" class="btn btn-success">Zapisz</button>
        <a th:href="@{/zakupy}" class="btn btn-secondary">Anuluj</a>

    </form>
</div>

</body>
</html>



CIEKA: src\main\resources\templates\zakupy_lista.html
----------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista Zakup贸w</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h1 class="mb-4 text-center">Lista zakup贸w</h1>

    <div th:if="${zakupy.empty}" class="alert alert-info text-center">
        Brak zakup贸w w systemie.
    </div>

    <table th:if="${!zakupy.empty}" class="table table-striped table-bordered">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Samoch贸d</th>
            <th>Klient</th>
            <th>Pracownik</th>
            <th>Data zakupu</th>
            <th>Cena</th>
            <th>Akcje</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="z : ${zakupy}">
            <td th:text="${z.id}"></td>
            <td th:text="${z.samochod.marka + ' ' + z.samochod.model}"></td>
            <td th:text="${z.klient.imie + ' ' + z.klient.nazwisko}"></td>
            <td th:text="${z.pracownik.imie + ' ' + z.pracownik.nazwisko}"></td>
            <td th:text="${z.dataZakupu}"></td>
            <td th:text="${z.cenaZakupu}"></td>

            <td>
                <a th:href="@{'/zakupy/edytuj/' + ${z.id}}" class="btn btn-primary btn-sm">Edytuj</a>
                <a th:href="@{'/zakupy/usun/' + ${z.id}}" class="btn btn-danger btn-sm"
                   onclick="return confirm('Na pewno usun?');">Usu</a>
            </td>
        </tr>
        </tbody>
    </table>

    <a th:href="@{/zakupy/dodaj}" class="btn btn-success mt-3">Dodaj zakup</a>
</div>

</body>
</html>



CIEKA: src\main\resources\templates\admin\change-password.html
-------------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Zmiana hasa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/admin/users">U偶ytkownicy</a>
                <a class="nav-link" href="/admin">Panel Admina</a>
                <a class="nav-link" href="/">Strona G贸wna</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0" th:text="${tytul}">Zmiana hasa</h4>
                </div>
                <div class="card-body">
                    <!-- Komunikaty -->
                    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle"></i>
                        <span th:text="${successMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span th:text="${errorMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        Zmieniasz haso dla u偶ytkownika: <strong th:text="${user.username}"></strong>
                    </div>

                    <form th:action="@{/admin/users/change-password/{id}(id=${user.id})}" method="post">
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">Nowe haso *</label>
                            <input type="password" class="form-control" id="newPassword"
                                   name="newPassword" required minlength="6">
                            <div class="form-text">Minimum 6 znak贸w</div>
                        </div>

                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Potwierd藕 nowe haso *</label>
                            <input type="password" class="form-control" id="confirmPassword"
                                   name="confirmPassword" required minlength="6">
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/admin/users" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Zmie haso
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Walidacja zgodnoci hase
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');

        form.addEventListener('submit', function(e) {
            if (newPassword.value !== confirmPassword.value) {
                e.preventDefault();
                alert('Hasa nie s identyczne!');
                confirmPassword.focus();
            }
        });
    });
</script>
</body>
</html>


CIEKA: src\main\resources\templates\admin\panel.html
---------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Panel Administracyjny</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <a class="nav-link" href="/search">
                    <i class="fas fa-search me-1"></i> Wyszukiwanie
                </a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                        <li><a class="dropdown-item" href="/stats"><i class="fas fa-chart-bar me-1"></i> Statystyki</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Strona G贸wna</a>
                <a class="nav-link" href="#" th:href="@{/logout}">Wyloguj</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4 text-center"><i class="fas fa-cogs"></i> Panel Administracyjny</h1>

    <div class="row">
        <!-- Statystyki -->
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-primary">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-3x mb-3"></i>
                    <h3 th:text="${totalUsers}">0</h3>
                    <p class="card-text">U偶ytkownik贸w</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-success">
                <div class="card-body text-center">
                    <i class="fas fa-car fa-3x mb-3"></i>
                    <h3 th:text="${totalCars}">0</h3>
                    <p class="card-text">Samochod贸w</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card text-white bg-info">
                <div class="card-body text-center">
                    <i class="fas fa-car-side fa-3x mb-3"></i>
                    <h3 th:text="${availableCars}">0</h3>
                    <p class="card-text">Dostpnych</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Szybkie akcje -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt"></i> Szybkie akcje</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="/admin/users" class="btn btn-outline-primary w-100">
                                <i class="fas fa-users-cog"></i><br>
                                Zarzdzaj u偶ytkownikami
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/samochody/nowy" class="btn btn-outline-success w-100">
                                <i class="fas fa-car"></i><br>
                                Dodaj samoch贸d
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/samochody" class="btn btn-outline-info w-100">
                                <i class="fas fa-list"></i><br>
                                Przegldaj samochody
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/klienci" class="btn btn-outline-warning w-100">
                                <i class="fas fa-user-friends"></i><br>
                                Lista klient贸w
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\admin\user-form.html
-------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Formularz u偶ytkownika</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/admin/users">U偶ytkownicy</a>
                <a class="nav-link" href="/admin">Panel Admina</a>
                <a class="nav-link" href="/">Strona G贸wna</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0" th:text="${tytul}">Formularz u偶ytkownika</h4>
                </div>
                <div class="card-body">
                    <!-- Komunikaty -->
                    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle"></i>
                        <span th:text="${successMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span th:text="${errorMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <!-- Formularz dla nowego u偶ytkownika -->
                    <form th:if="${user.id == null}" th:action="@{/admin/users/create}"
                          method="post" th:object="${user}">

                        <div class="mb-3">
                            <label for="username" class="form-label">Nazwa u偶ytkownika *</label>
                            <input type="text" class="form-control" id="username"
                                   th:field="*{username}" required minlength="3" maxlength="50">
                            <div class="form-text">Minimum 3 znaki</div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="email"
                                   th:field="*{email}" required>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Haso *</label>
                            <input type="password" class="form-control" id="password"
                                   name="password" required minlength="6">
                            <div class="form-text">Minimum 6 znak贸w</div>
                        </div>

                        <div class="mb-3">
                            <label for="role" class="form-label">Rola *</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="">Wybierz rol</option>
                                <option th:each="role : ${roles}"
                                        th:value="${role}"
                                        th:text="${role}"></option>
                            </select>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/admin/users" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">Utw贸rz u偶ytkownika</button>
                        </div>
                    </form>

                    <!-- Formularz dla edycji u偶ytkownika -->
                    <form th:if="${user.id != null}" th:action="@{/admin/users/edit/{id}(id=${user.id})}"
                          method="post" th:object="${user}">

                        <div class="mb-3">
                            <label for="username" class="form-label">Nazwa u偶ytkownika *</label>
                            <input type="text" class="form-control" id="username"
                                   th:field="*{username}" required minlength="3" maxlength="50">
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="email"
                                   th:field="*{email}" required>
                        </div>

                        <div class="mb-3">
                            <label for="newPassword" class="form-label">Nowe haso (opcjonalnie)</label>
                            <input type="password" class="form-control" id="newPassword"
                                   name="newPassword" minlength="6">
                            <div class="form-text">Zostaw puste, jeli nie chcesz zmienia hasa</div>
                        </div>

                        <div class="mb-3">
                            <label for="role" class="form-label">Rola *</label>
                            <select class="form-select" id="role" th:field="*{role}" required>
                                <option th:each="role : ${roles}"
                                        th:value="${role}"
                                        th:text="${role}"
                                        th:selected="${role == user.role}"></option>
                            </select>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="enabled"
                                   th:field="*{enabled}">
                            <label class="form-check-label" for="enabled">Konto aktywne</label>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/admin/users" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">Zaktualizuj u偶ytkownika</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\admin\users.html
---------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Zarzdzanie u偶ytkownikami</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .actions-column {
            width: 250px;
        }
        .status-badge {
            font-size: 0.8em;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                <a class="nav-link" href="/admin">Panel Admina</a>
                <a class="nav-link" href="/">Strona G贸wna</a>
                <a class="nav-link" href="#" th:href="@{/logout}">Wyloguj</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-users-cog"></i> Zarzdzanie u偶ytkownikami</h1>
        <a href="/admin/users/create" class="btn btn-success">
            <i class="fas fa-user-plus"></i> Dodaj u偶ytkownika
        </a>
    </div>

    <!-- Komunikaty -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle"></i>
        <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-list"></i> Lista u偶ytkownik贸w</h5>
        </div>
        <div class="card-body">
            <div th:if="${users.empty}" class="alert alert-info text-center">
                <i class="fas fa-info-circle"></i> Brak u偶ytkownik贸w w systemie.
            </div>

            <div th:if="${!users.empty}" class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nazwa u偶ytkownika</th>
                        <th>Email</th>
                        <th>Rola</th>
                        <th>Status</th>
                        <th>Data utworzenia</th>
                        <th class="actions-column">Akcje</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.id}"></td>
                        <td>
                            <strong th:text="${user.username}"></strong>
                        </td>
                        <td th:text="${user.email}"></td>
                        <td>
                            <span th:if="${user.role == 'USER'}" class="badge bg-primary" th:text="${user.role}"></span>
                            <span th:if="${user.role == 'ADMIN'}" class="badge bg-success" th:text="${user.role}"></span>
                        </td>
                        <td>
                            <span th:if="${user.enabled}" class="badge bg-success status-badge">Aktywny</span>
                            <span th:if="${!user.enabled}" class="badge bg-danger status-badge">Nieaktywny</span>
                        </td>
                        <td>
                            <small th:text="${#temporals.format(user.createdAt, 'dd.MM.yyyy HH:mm')}"></small>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <!-- Edycja -->
                                <a th:href="@{/admin/users/edit/{id}(id=${user.id})}"
                                   class="btn btn-outline-primary" title="Edytuj">
                                    <i class="fas fa-edit"></i>
                                </a>

                                <!-- Zmiana hasa -->
                                <a th:href="@{/admin/users/change-password/{id}(id=${user.id})}"
                                   class="btn btn-outline-warning" title="Zmie haso">
                                    <i class="fas fa-key"></i>
                                </a>

                                <!-- Aktywacja/Dezaktywacja -->
                                <form th:action="@{/admin/users/toggle-status/{id}(id=${user.id})}"
                                      method="post" style="display: inline;">
                                    <button type="submit"
                                            th:classappend="${user.enabled} ? 'btn-outline-warning' : 'btn-outline-success'"
                                            class="btn"
                                            th:title="${user.enabled} ? 'Dezaktywuj' : 'Aktywuj'">
                                        <i th:if="${user.enabled}" class="fas fa-user-slash"></i>
                                        <i th:if="${!user.enabled}" class="fas fa-user-check"></i>
                                    </button>
                                </form>

                                <!-- Usuwanie -->
                                <form th:action="@{/admin/users/delete/{id}(id=${user.id})}"
                                      method="post" style="display: inline;"
                                      onsubmit="return confirm('Czy na pewno chcesz usun u偶ytkownika ' + [[${user.username}]] + '?')">
                                    <button type="submit" class="btn btn-outline-danger" title="Usu">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <a href="/admin" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Powr贸t do panelu admina
        </a>
        <a href="/" class="btn btn-outline-secondary ms-2">
            <i class="fas fa-home"></i> Strona g贸wna
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\fragments\samochod-form-fields.html
----------------------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="form-fields">
    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="marka" class="form-label">Marka *</label>
            <input type="text" class="form-control" id="marka"
                   th:field="*{marka}" required>
        </div>

        <div class="col-md-6 mb-3">
            <label for="model" class="form-label">Model *</label>
            <input type="text" class="form-control" id="model"
                   th:field="*{model}" required>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="rokProdukcji" class="form-label">Rok Produkcji *</label>
            <input type="number" class="form-control" id="rokProdukcji"
                   th:field="*{rokProdukcji}" min="1990" max="2025" required>
        </div>

        <div class="col-md-4 mb-3">
            <label for="przebieg" class="form-label">Przebieg (km) *</label>
            <input type="number" class="form-control" id="przebieg"
                   th:field="*{przebieg}" min="0" required>
        </div>

        <div class="col-md-4 mb-3">
            <label for="cena" class="form-label">Cena (PLN) *</label>
            <input type="number" step="0.01" class="form-control" id="cena"
                   th:field="*{cena}" min="0" required>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4 mb-3">
            <label for="kolor" class="form-label">Kolor</label>
            <input type="text" class="form-control" id="kolor"
                   th:field="*{kolor}">
        </div>

        <div class="col-md-4 mb-3">
            <label for="pojemnoscSilnika" class="form-label">Pojemno silnika</label>
            <input type="number" step="0.1" class="form-control" id="pojemnoscSilnika"
                   th:field="*{pojemnoscSilnika}">
        </div>

        <div class="col-md-4 mb-3">
            <label for="status" class="form-label">Status *</label>
            <select class="form-select" id="status" th:field="*{status}" required>
                <option value="">Wybierz status</option>
                <option value="DOSTEPNY">Dostpny</option>
                <option value="SPRZEDANY">Sprzedany</option>
                <option value="ZAREZERWOWANY">Zarezerwowany</option>
            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-3">
            <label for="rodzajPaliwa" class="form-label">Rodzaj paliwa</label>
            <select class="form-select" id="rodzajPaliwa" th:field="*{rodzajPaliwa}">
                <option value="Benzyna">Benzyna</option>
                <option value="Diesel">Diesel</option>
                <option value="Hybryda">Hybryda</option>
                <option value="Elektryczny">Elektryczny</option>
            </select>
        </div>

        <div class="col-md-6 mb-3">
            <label for="skrzyniaBiegow" class="form-label">Skrzynia bieg贸w</label>
            <select class="form-select" id="skrzyniaBiegow" th:field="*{skrzyniaBiegow}">
                <option value="Manualna">Manualna</option>
                <option value="Automatyczna">Automatyczna</option>
            </select>
        </div>
    </div>
</div>
</body>
</html>


CIEKA: src\main\resources\templates\samochody\form.html
------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Formularz Samochodu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <!-- Dodaj t sekcj do navbar -->
        <div class="navbar-nav">
            <!-- Link Klienci tylko dla admina -->
            <div sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" th:href="@{/klienci}">Klienci</a>
                <a class="nav-link" th:href="@{/pracownicy}">Pracownicy</a>
            </div>
        </div>

        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3" sec:authentication="name"></span>
            <a class="nav-link" href="/samochody">Powr贸t do listy</a>
            <a class="nav-link" href="#" th:href="@{/logout}">Wyloguj</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h4 th:text="${tytul}" class="mb-0">Formularz Samochodu</h4>
                </div>
                <div class="card-body">
                    <!-- Formularz dla nowego samochodu -->
                    <form th:if="${samochod.id == null}" th:action="@{/samochody/zapisz}"
                          method="post" th:object="${samochod}">

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="marka" class="form-label">Marka *</label>
                                <input type="text" class="form-control" id="marka"
                                       th:field="*{marka}" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="model" class="form-label">Model *</label>
                                <input type="text" class="form-control" id="model"
                                       th:field="*{model}" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="rokProdukcji" class="form-label">Rok Produkcji *</label>
                                <input type="number" class="form-control" id="rokProdukcji"
                                       th:field="*{rokProdukcji}" min="1990" max="2025" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="przebieg" class="form-label">Przebieg (km) *</label>
                                <input type="number" class="form-control" id="przebieg"
                                       th:field="*{przebieg}" min="0" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="cena" class="form-label">Cena (z) *</label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="cena"
                                           th:field="*{cena}" min="0" required>
                                    <span class="input-group-text">z</span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="kolor" class="form-label">Kolor</label>
                                <input type="text" class="form-control" id="kolor"
                                       th:field="*{kolor}">
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="pojemnoscSilnika" class="form-label">Pojemno silnika</label>
                                <div class="input-group">
                                    <input type="number" step="0.1" class="form-control" id="pojemnoscSilnika"
                                           th:field="*{pojemnoscSilnika}">
                                    <span class="input-group-text">L</span>
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="status" class="form-label">Status *</label>
                                <select class="form-select" id="status" th:field="*{status}" required>
                                    <option value="">Wybierz status</option>
                                    <option value="DOSTEPNY">Dostpny</option>
                                    <option value="SPRZEDANY">Sprzedany</option>
                                    <option value="ZAREZERWOWANY">Zarezerwowany</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="rodzajPaliwa" class="form-label">Rodzaj paliwa</label>
                                <select class="form-select" id="rodzajPaliwa" th:field="*{rodzajPaliwa}">
                                    <option value="Benzyna">Benzyna</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Hybryda">Hybryda</option>
                                    <option value="Elektryczny">Elektryczny</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="skrzyniaBiegow" class="form-label">Skrzynia bieg贸w</label>
                                <select class="form-select" id="skrzyniaBiegow" th:field="*{skrzyniaBiegow}">
                                    <option value="Manualna">Manualna</option>
                                    <option value="Automatyczna">Automatyczna</option>
                                </select>
                            </div>
                        </div>

                        <!-- DODANE: Pole na URL zdjcia -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="zdjecieUrl" class="form-label">URL zdjcia</label>
                                <input type="url" class="form-control" id="zdjecieUrl"
                                       th:field="*{zdjecieUrl}" placeholder="https://example.com/obrazek.jpg">
                                <div class="form-text">
                                    Wklej link do zdjcia samochodu (opcjonalne)
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/samochody" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">Zapisz</button>
                        </div>
                    </form>

                    <!-- Formularz dla edycji samochodu -->
                    <form th:if="${samochod.id != null}" th:action="@{/samochody/edytuj(id=${samochod.id})}"
                          method="post" th:object="${samochod}">

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="marka" class="form-label">Marka *</label>
                                <input type="text" class="form-control" id="marka"
                                       th:field="*{marka}" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="model" class="form-label">Model *</label>
                                <input type="text" class="form-control" id="model"
                                       th:field="*{model}" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="rokProdukcji" class="form-label">Rok Produkcji *</label>
                                <input type="number" class="form-control" id="rokProdukcji"
                                       th:field="*{rokProdukcji}" min="1990" max="2025" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="przebieg" class="form-label">Przebieg (km) *</label>
                                <input type="number" class="form-control" id="przebieg"
                                       th:field="*{przebieg}" min="0" required>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="cena" class="form-label">Cena (z) *</label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="cena"
                                           th:field="*{cena}" min="0" required>
                                    <span class="input-group-text">z</span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="kolor" class="form-label">Kolor</label>
                                <input type="text" class="form-control" id="kolor"
                                       th:field="*{kolor}">
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="pojemnoscSilnika" class="form-label">Pojemno silnika</label>
                                <div class="input-group">
                                    <input type="number" step="0.1" class="form-control" id="pojemnoscSilnika"
                                           th:field="*{pojemnoscSilnika}">
                                    <span class="input-group-text">L</span>
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="status" class="form-label">Status *</label>
                                <select class="form-select" id="status" th:field="*{status}" required>
                                    <option value="">Wybierz status</option>
                                    <option value="DOSTEPNY">Dostpny</option>
                                    <option value="SPRZEDANY">Sprzedany</option>
                                    <option value="ZAREZERWOWANY">Zarezerwowany</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="rodzajPaliwa" class="form-label">Rodzaj paliwa</label>
                                <select class="form-select" id="rodzajPaliwa" th:field="*{rodzajPaliwa}">
                                    <option value="Benzyna">Benzyna</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Hybryda">Hybryda</option>
                                    <option value="Elektryczny">Elektryczny</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="skrzyniaBiegow" class="form-label">Skrzynia bieg贸w</label>
                                <select class="form-select" id="skrzyniaBiegow" th:field="*{skrzyniaBiegow}">
                                    <option value="Manualna">Manualna</option>
                                    <option value="Automatyczna">Automatyczna</option>
                                </select>
                            </div>
                        </div>

                        <!-- DODANE: Pole na URL zdjcia -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="zdjecieUrl" class="form-label">URL zdjcia</label>
                                <input type="url" class="form-control" id="zdjecieUrl"
                                       th:field="*{zdjecieUrl}" placeholder="https://example.com/obrazek.jpg">
                                <div class="form-text">
                                    Wklej link do zdjcia samochodu (opcjonalne)
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/samochody" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">Zaktualizuj</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\samochody\lista.html
-------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Lista Samochod贸w - Komis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .car-image {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: 5px;
        }
        .no-image {
            width: 100px;
            height: 75px;
            background-color: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <a class="nav-link" href="/search">
                    <i class="fas fa-search me-1"></i> Zaawansowane wyszukiwanie
                </a>
                <div sec:authorize="hasRole('ADMIN')" class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        Admin
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/admin">Panel Admina</a></li>
                        <li><a class="dropdown-item" href="/admin/users">U偶ytkownicy</a></li>
                        <li><a class="dropdown-item" href="/klienci">Klienci</a></li>
                        <li><a class="dropdown-item" href="/pracownicy">Pracownicy</a></li>
                    </ul>
                </div>
            </div>

            <div class="navbar-nav ms-auto">
                <div sec:authorize="isAuthenticated()">
                    <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                    <a class="nav-link" href="#" th:href="@{/logout}">Wyloguj</a>
                </div>
                <div sec:authorize="!isAuthenticated()">
                    <a class="nav-link" href="/login">Zaloguj</a>
                    <a class="nav-link" href="/register">Rejestracja</a>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1> Lista Samochod贸w</h1>
        <div>
            <a href="/" class="btn btn-secondary">
                <i class="fas fa-home"></i> Strona G贸wna
            </a>
            <a sec:authorize="hasRole('ADMIN')" href="/samochody/nowy" class="btn btn-success ms-2">
                <i class="fas fa-plus"></i> Dodaj Samoch贸d
            </a>
        </div>
    </div>

    <!-- Panel wyszukiwania -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-search me-2"></i>Szybkie wyszukiwanie</h5>
        </div>
        <div class="card-body">
            <form th:action="@{/samochody}" method="get" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Marka</label>
                    <select class="form-select" name="marka">
                        <option value="">Wybierz mark</option>
                        <option th:each="marka : ${marki}"
                                th:value="${marka}"
                                th:selected="${searchMarka == marka}"
                                th:text="${marka}"></option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Model</label>
                    <input type="text" class="form-control" name="model"
                           th:value="${searchModel}" placeholder="Wpisz model">
                </div>
                <div class="col-md-4">
                    <label class="form-label">Status</label>
                    <select class="form-select" name="status">
                        <option value="">Dowolny status</option>
                        <option value="DOSTEPNY" th:selected="${searchStatus == 'DOSTEPNY'}">Dostpny</option>
                        <option value="ZAREZERWOWANY" th:selected="${searchStatus == 'ZAREZERWOWANY'}">Zarezerwowany</option>
                        <option value="SPRZEDANY" th:selected="${searchStatus == 'SPRZEDANY'}">Sprzedany</option>
                    </select>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-1"></i> Szukaj
                    </button>
                    <a href="/samochody" class="btn btn-secondary ms-2">
                        <i class="fas fa-times me-1"></i> Wyczy
                    </a>
                    <a href="/search" class="btn btn-outline-primary ms-2">
                        <i class="fas fa-sliders-h me-1"></i> Zaawansowane wyszukiwanie
                    </a>
                </div>
            </form>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Zdjcie</th>
                <th>Marka</th>
                <th>Model</th>
                <th>Rok</th>
                <th>Cena</th>
                <th>Przebieg</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="samochod : ${samochody}">
                <td>
                    <div th:if="${samochod.zdjecieUrl != null and samochod.zdjecieUrl != ''}">
                        <img th:src="${samochod.zdjecieUrl}" alt="Zdjcie samochodu" class="car-image">
                    </div>
                    <div th:if="${samochod.zdjecieUrl == null or samochod.zdjecieUrl == ''}" class="no-image">
                        <i class="fas fa-car"></i>
                    </div>
                </td>
                <td th:text="${samochod.marka}"></td>
                <td th:text="${samochod.model}"></td>
                <td th:text="${samochod.rokProdukcji}"></td>
                <td>
                    <strong th:text="${#numbers.formatDecimal(samochod.cena, 0, 'COMMA', 2, 'POINT') + ' z'}"></strong>
                </td>
                <td th:text="${#numbers.formatInteger(samochod.przebieg, 0, 'COMMA') + ' km'}"></td>
                <td>
                    <span th:if="${samochod.status == 'DOSTEPNY'}" class="badge bg-success">Dostpny</span>
                    <span th:if="${samochod.status == 'SPRZEDANY'}" class="badge bg-danger">Sprzedany</span>
                    <span th:if="${samochod.status == 'ZAREZERWOWANY'}" class="badge bg-warning">Zarezerwowany</span>
                </td>
                <td>
                    <div class="btn-group-vertical btn-group-sm">
                        <a th:href="@{/samochody/szczegoly(id=${samochod.id})}" class="btn btn-outline-primary mb-1">
                            <i class="fas fa-eye"></i> Szczeg贸y
                        </a>
                        <div sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/samochody/edytuj(id=${samochod.id})}" class="btn btn-outline-warning mb-1">
                                <i class="fas fa-edit"></i> Edytuj
                            </a>
                            <form th:action="@{/samochody/usun(id=${samochod.id})}" method="post"
                                  onsubmit="return confirm('Czy na pewno chcesz usun ten samoch贸d?')">
                                <button type="submit" class="btn btn-outline-danger w-100">
                                    <i class="fas fa-trash"></i> Usu
                                </button>
                            </form>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${samochody.empty}" class="alert alert-info text-center">
        <i class="fas fa-car fa-2x mb-3"></i><br>
        <span th:if="${hasSearchParams}">Nie znaleziono samochod贸w speniajcych podane kryteria.</span>
        <span th:if="${not hasSearchParams}">Brak samochod贸w w bazie danych.</span>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\samochody\szczegoly.html
-----------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Szczeg贸y Samochodu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .car-image-large {
            width: 100%;
            max-width: 600px;
            height: 400px;
            object-fit: cover;
            border-radius: 10px;
        }
        .no-image-large {
            width: 100%;
            max-width: 600px;
            height: 400px;
            background-color: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 4rem;
        }
        .specs-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        .price-tag {
            font-size: 2.5rem;
            font-weight: bold;
            color: #28a745;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <!-- Dodaj t sekcj do navbar -->
        <div class="navbar-nav">
            <!-- Link Klienci tylko dla admina -->
            <div sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" th:href="@{/klienci}">Klienci</a>
                <a class="nav-link" th:href="@{/pracownicy}">Pracownicy</a>
            </div>
        </div>

        <div class="navbar-nav ms-auto">
            <div sec:authorize="isAuthenticated()">
                <span class="navbar-text me-3">Witaj, <span sec:authentication="name"></span></span>
                <a class="nav-link d-inline" href="#" th:href="@{/logout}">Wyloguj</a>
            </div>
            <div sec:authorize="!isAuthenticated()">
                <a class="nav-link" href="/login">Zaloguj</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <!-- Zdjcie samochodu -->
            <div class="text-center mb-4">
                <div th:if="${samochod.zdjecieUrl != null and samochod.zdjecieUrl != ''}">
                    <img th:src="${samochod.zdjecieUrl}"
                         th:alt="${samochod.marka + ' ' + samochod.model}"
                         class="car-image-large shadow">
                </div>
                <div th:if="${samochod.zdjecieUrl == null or samochod.zdjecieUrl == ''}" class="no-image-large">
                    <i class="fas fa-car"></i>
                </div>
            </div>

            <!-- Szczeg贸y techniczne -->
            <div class="card mb-4">
                <div class="card-header specs-card">
                    <h4 class="mb-0"><i class="fas fa-cogs me-2"></i>Szczeg贸y techniczne</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Marka:</strong></td>
                                    <td th:text="${samochod.marka}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Model:</strong></td>
                                    <td th:text="${samochod.model}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Rok produkcji:</strong></td>
                                    <td th:text="${samochod.rokProdukcji}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Przebieg:</strong></td>
                                    <td th:text="${#numbers.formatInteger(samochod.przebieg, 0, 'COMMA') + ' km'}"></td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td><strong>Pojemno silnika:</strong></td>
                                    <td th:text="${samochod.pojemnoscSilnika + ' L'}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Rodzaj paliwa:</strong></td>
                                    <td th:text="${samochod.rodzajPaliwa}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Skrzynia bieg贸w:</strong></td>
                                    <td th:text="${samochod.skrzyniaBiegow}"></td>
                                </tr>
                                <tr>
                                    <td><strong>Kolor:</strong></td>
                                    <td th:text="${samochod.kolor}"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <!-- Panel boczny z cen i akcjami -->
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-body text-center">
                    <h3 th:text="${samochod.marka + ' ' + samochod.model}"></h3>
                    <div class="price-tag mb-3" th:text="${#numbers.formatDecimal(samochod.cena, 0, 'COMMA', 2, 'POINT') + ' z'}"></div>

                    <!-- Status -->
                    <div class="mb-3">
                            <span th:if="${samochod.status == 'DOSTEPNY'}"
                                  class="badge bg-success fs-6" th:text="${samochod.status}"></span>
                        <span th:if="${samochod.status == 'SPRZEDANY'}"
                              class="badge bg-danger fs-6" th:text="${samochod.status}"></span>
                        <span th:if="${samochod.status == 'ZAREZERWOWANY'}"
                              class="badge bg-warning fs-6" th:text="${samochod.status}"></span>
                    </div>

                    <!-- Przyciski akcji dla zalogowanych u偶ytkownik贸w -->
                    <div sec:authorize="isAuthenticated() and !hasRole('ADMIN')">
                        <div th:if="${samochod.status == 'DOSTEPNY'}" class="d-grid gap-2">
                            <form th:action="@{/samochody/zarezerwuj(id=${samochod.id})}"
                                  method="post">
                                <button type="submit" class="btn btn-warning btn-lg w-100 mb-2">
                                    <i class="fas fa-clock"></i> Zarezerwuj
                                </button>
                            </form>
                            <form th:action="@{/samochody/kup(id=${samochod.id})}"
                                  method="post"
                                  onsubmit="return confirm('Czy na pewno chcesz kupi ten samoch贸d?')">
                                <button type="submit" class="btn btn-success btn-lg w-100">
                                    <i class="fas fa-shopping-cart"></i> Kup teraz
                                </button>
                            </form>
                        </div>

                        <div th:if="${samochod.status == 'ZAREZERWOWANY'}" class="d-grid gap-2">
                            <form th:action="@{/samochody/kup(id=${samochod.id})}"
                                  method="post"
                                  onsubmit="return confirm('Czy na pewno chcesz kupi ten samoch贸d?')">
                                <button type="submit" class="btn btn-success btn-lg w-100 mb-2">
                                    <i class="fas fa-shopping-cart"></i> Kup teraz
                                </button>
                            </form>
                            <form th:action="@{/samochody/anuluj-rezerwacje(id=${samochod.id})}"
                                  method="post">
                                <button type="submit" class="btn btn-secondary btn-lg w-100">
                                    <i class="fas fa-times"></i> Anuluj rezerwacj
                                </button>
                            </form>
                        </div>

                        <div th:if="${samochod.status == 'SPRZEDANY'}">
                            <div class="alert alert-danger text-center">
                                <i class="fas fa-times-circle"></i><br>
                                Ten samoch贸d zosta ju偶 sprzedany
                            </div>
                        </div>
                    </div>

                    <!-- Komunikat dla niezalogowanych -->
                    <div sec:authorize="!isAuthenticated()">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Aby m贸c rezerwowa lub kupowa ten samoch贸d,
                            <a href="/login" class="alert-link">zaloguj si</a>.
                        </div>
                        <div th:if="${samochod.status == 'ZAREZERWOWANY'}">
                            <div class="alert alert-warning text-center">
                                <i class="fas fa-clock"></i><br>
                                Samoch贸d zarezerwowany
                            </div>
                        </div>
                        <div th:if="${samochod.status == 'SPRZEDANY'}">
                            <div class="alert alert-danger text-center">
                                <i class="fas fa-times-circle"></i><br>
                                Samoch贸d sprzedany
                            </div>
                        </div>
                    </div>

                    <!-- Przyciski admina -->
                    <div sec:authorize="hasRole('ADMIN')" class="d-grid gap-2 mt-3">
                        <a th:href="@{/samochody/edytuj(id=${samochod.id})}"
                           class="btn btn-warning">
                            <i class="fas fa-edit"></i> Edytuj
                        </a>
                        <form th:action="@{/samochody/usun(id=${samochod.id})}"
                              method="post"
                              onsubmit="return confirm('Czy na pewno chcesz usun ten samoch贸d?')">
                            <button type="submit" class="btn btn-danger w-100">
                                <i class="fas fa-trash"></i> Usu
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Przycisk powrotu -->
    <div class="mt-4">
        <a href="/samochody" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Powr贸t do listy samochod贸w
        </a>
        <a href="/" class="btn btn-outline-secondary ms-2">
            <i class="fas fa-home"></i> Strona g贸wna
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\search\form.html
---------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Zaawansowane wyszukiwanie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/samochody">Lista samochod贸w</a>
            <a class="nav-link" href="/">Strona g贸wna</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0"><i class="fas fa-search me-2"></i>Zaawansowane wyszukiwanie samochod贸w</h4>
                </div>
                <div class="card-body">
                    <form th:action="@{/search}" th:object="${searchCriteria}" method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="marka" class="form-label">Marka</label>
                                <select class="form-select" id="marka" th:field="*{marka}">
                                    <option value="">Wybierz mark</option>
                                    <option th:each="marka : ${marki}"
                                            th:value="${marka}"
                                            th:text="${marka}"></option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="model" class="form-label">Model</label>
                                <input type="text" class="form-control" id="model" th:field="*{model}"
                                       placeholder="Wpisz model">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="minRok" class="form-label">Rok produkcji od</label>
                                <input type="number" class="form-control" id="minRok" th:field="*{minRok}"
                                       min="1990" max="2025" placeholder="1990">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="maxRok" class="form-label">Rok produkcji do</label>
                                <input type="number" class="form-control" id="maxRok" th:field="*{maxRok}"
                                       min="1990" max="2025" placeholder="2025">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="minPrzebieg" class="form-label">Przebieg od (km)</label>
                                <input type="number" class="form-control" id="minPrzebieg" th:field="*{minPrzebieg}"
                                       min="0" placeholder="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="maxPrzebieg" class="form-label">Przebieg do (km)</label>
                                <input type="number" class="form-control" id="maxPrzebieg" th:field="*{maxPrzebieg}"
                                       min="0" placeholder="500000">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="minCena" class="form-label">Cena od (z)</label>
                                <input type="number" class="form-control" id="minCena" th:field="*{minCena}"
                                       min="0" step="1000" placeholder="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="maxCena" class="form-label">Cena do (z)</label>
                                <input type="number" class="form-control" id="maxCena" th:field="*{maxCena}"
                                       min="0" step="1000" placeholder="500000">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="rodzajPaliwa" class="form-label">Rodzaj paliwa</label>
                                <select class="form-select" id="rodzajPaliwa" th:field="*{rodzajPaliwa}">
                                    <option value="">Dowolny</option>
                                    <option value="Benzyna">Benzyna</option>
                                    <option value="Diesel">Diesel</option>
                                    <option value="Hybryda">Hybryda</option>
                                    <option value="Elektryczny">Elektryczny</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="status" class="form-label">Status</label>
                                <select class="form-select" id="status" th:field="*{status}">
                                    <option value="">Dowolny</option>
                                    <option value="DOSTEPNY">Dostpny</option>
                                    <option value="ZAREZERWOWANY">Zarezerwowany</option>
                                    <option value="SPRZEDANY">Sprzedany</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/samochody" class="btn btn-secondary me-md-2">Anuluj</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search me-1"></i> Szukaj
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Szybkie wyszukiwanie -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Szybkie wyszukiwanie</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/search/quick}" method="get" class="row g-3">
                        <div class="col-md-4">
                            <select class="form-select" name="marka">
                                <option value="">Wybierz mark</option>
                                <option th:each="marka : ${marki}"
                                        th:value="${marka}"
                                        th:text="${marka}"></option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control" name="model" placeholder="Model">
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" name="status">
                                <option value="">Dowolny status</option>
                                <option value="DOSTEPNY">Dostpny</option>
                                <option value="ZAREZERWOWANY">Zarezerwowany</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-outline-primary w-100">
                                <i class="fas fa-search me-1"></i> Szybkie wyszukiwanie
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\search\results.html
------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Wyniki wyszukiwania - Komis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .car-image {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
        }
        .no-image {
            width: 80px;
            height: 60px;
            background-color: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 0.8rem;
        }
        .search-criteria {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .login-required {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav">
                <a class="nav-link" href="/samochody">Samochody</a>
                <a class="nav-link" href="/search">
                    <i class="fas fa-search me-1"></i> Zaawansowane wyszukiwanie
                </a>
            </div>

            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/login">Zaloguj</a>
                <a class="nav-link" href="/register">Rejestracja</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-search me-2"></i> Wyniki wyszukiwania</h1>
        <div>
            <a href="/search" class="btn btn-primary">
                <i class="fas fa-arrow-left me-1"></i> Nowe wyszukiwanie
            </a>
            <a href="/samochody" class="btn btn-secondary ms-2">
                <i class="fas fa-list me-1"></i> Wszystkie samochody
            </a>
        </div>
    </div>

    <!-- Informacja o koniecznoci logowania -->
    <div class="alert alert-warning login-required mb-4">
        <i class="fas fa-info-circle me-2"></i>
        <strong>Aby rezerwowa i kupowa samochody, musisz si zalogowa.</strong>
        <a href="/login" class="alert-link ms-2">Zaloguj si teraz</a>
    </div>

    <!-- Podsumowanie kryteri贸w wyszukiwania -->
    <div class="card search-criteria mb-4">
        <div class="card-body">
            <h5 class="card-title"><i class="fas fa-filter me-2"></i>Kryteria wyszukiwania</h5>
            <div class="row">
                <div class="col-md-6">
                    <small class="text-muted">Znaleziono: <strong th:text="${resultsCount}"></strong> samochod贸w</small>
                </div>
                <div class="col-md-6 text-end">
                    <small class="text-muted">
                        <span th:if="${searchCriteria.marka}">Marka: <strong th:text="${searchCriteria.marka}"></strong></span>
                        <span th:if="${searchCriteria.model}">, Model: <strong th:text="${searchCriteria.model}"></strong></span>
                        <span th:if="${searchCriteria.status}">, Status: <strong th:text="${searchCriteria.status}"></strong></span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${samochody.empty}" class="alert alert-info text-center">
        <i class="fas fa-search fa-2x mb-3"></i><br>
        <h4>Nie znaleziono samochod贸w speniajcych podane kryteria</h4>
        <p class="mb-0">Spr贸buj zmieni kryteria wyszukiwania lub <a href="/samochody" class="alert-link">przejd藕 do wszystkich samochod贸w</a></p>
    </div>

    <div th:if="${!samochody.empty}" class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Zdjcie</th>
                <th>Marka</th>
                <th>Model</th>
                <th>Rok</th>
                <th>Przebieg</th>
                <th>Cena</th>
                <th>Paliwo</th>
                <th>Status</th>
                <th>Akcje</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="samochod : ${samochody}">
                <!-- Zdjcie -->
                <td>
                    <a th:href="@{/samochody/szczegoly(id=${samochod.id})}" style="text-decoration: none;">
                        <div th:if="${samochod.zdjecieUrl != null and samochod.zdjecieUrl != ''}">
                            <img th:src="${samochod.zdjecieUrl}"
                                 th:alt="${samochod.marka + ' ' + samochod.model}"
                                 class="car-image">
                        </div>
                        <div th:if="${samochod.zdjecieUrl == null or samochod.zdjecieUrl == ''}" class="no-image">
                            <i class="fas fa-car"></i>
                        </div>
                    </a>
                </td>

                <!-- Marka -->
                <td>
                    <a th:href="@{/samochody/szczegoly(id=${samochod.id})}" class="text-dark fw-bold" style="text-decoration: none;">
                        <span th:text="${samochod.marka}"></span>
                    </a>
                </td>

                <!-- Model -->
                <td th:text="${samochod.model}"></td>

                <!-- Rok -->
                <td th:text="${samochod.rokProdukcji}"></td>

                <!-- Przebieg -->
                <td th:text="${#numbers.formatInteger(samochod.przebieg, 0, 'COMMA') + ' km'}"></td>

                <!-- Cena -->
                <td>
                    <strong class="text-success"
                            th:text="${#numbers.formatDecimal(samochod.cena, 0, 'COMMA', 2, 'POINT') + ' z'}">
                    </strong>
                </td>

                <!-- Paliwo -->
                <td>
                    <span th:if="${samochod.rodzajPaliwa}"
                          class="badge bg-info"
                          th:text="${samochod.rodzajPaliwa}">
                    </span>
                    <span th:if="${!samochod.rodzajPaliwa}" class="text-muted">-</span>
                </td>

                <!-- Status -->
                <td>
                    <span th:if="${samochod.status == 'DOSTEPNY'}" class="badge bg-success">Dostpny</span>
                    <span th:if="${samochod.status == 'SPRZEDANY'}" class="badge bg-danger">Sprzedany</span>
                    <span th:if="${samochod.status == 'ZAREZERWOWANY'}" class="badge bg-warning">Zarezerwowany</span>
                </td>

                <!-- Akcje -->
                <td>
                    <div class="btn-group-vertical btn-group-sm">
                        <!-- Przycisk szczeg贸贸w - dostpny dla wszystkich -->
                        <a th:href="@{/samochody/szczegoly(id=${samochod.id})}"
                           class="btn btn-outline-primary mb-1">
                            <i class="fas fa-eye"></i> Szczeg贸y
                        </a>

                        <!-- Informacja o koniecznoci logowania dla akcji -->
                        <div th:if="${samochod.status == 'DOSTEPNY'}">
                            <a href="/login" class="btn btn-outline-warning btn-sm w-100 mb-1">
                                <i class="fas fa-clock"></i> Zaloguj si aby rezerwowa
                            </a>
                        </div>
                        <div th:if="${samochod.status == 'ZAREZERWOWANY'}">
                            <span class="badge bg-warning">Zarezerwowany</span>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Przyciski nawigacyjne -->
    <div class="mt-4">
        <a href="/search" class="btn btn-primary">
            <i class="fas fa-search me-1"></i> Nowe wyszukiwanie
        </a>
        <a href="/samochody" class="btn btn-outline-secondary ms-2">
            <i class="fas fa-list me-1"></i> Wszystkie samochody
        </a>
        <a href="/" class="btn btn-outline-secondary ms-2">
            <i class="fas fa-home me-1"></i> Strona g贸wna
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


CIEKA: src\main\resources\templates\stats\car-stats.html
-------------------------------------------------------------
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${tytul}">Statystyki samochod贸w</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/"> Komis Samochodowy</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin">Panel Admina</a>
            <a class="nav-link" href="/">Strona g贸wna</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h1 class="mb-4"><i class="fas fa-chart-bar me-2"></i>Statystyki samochod贸w</h1>

    <!-- Statystyki og贸lne -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-primary">
                <div class="card-body text-center">
                    <i class="fas fa-car fa-2x mb-2"></i>
                    <h3 th:text="${stats.totalCars}">0</h3>
                    <p class="card-text">Wszystkich samochod贸w</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-success">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                    <h3 th:text="${stats.availableCars}">0</h3>
                    <p class="card-text">Dostpnych</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-warning">
                <div class="card-body text-center">
                    <i class="fas fa-clock fa-2x mb-2"></i>
                    <h3 th:text="${stats.reservedCars}">0</h3>
                    <p class="card-text">Zarezerwowanych</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card text-white bg-danger">
                <div class="card-body text-center">
                    <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                    <h3 th:text="${stats.soldCars}">0</h3>
                    <p class="card-text">Sprzedanych</p>
                </div>
            </div>
        </div>
    </div>

    <!-- rednia cena -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <h4 class="text-success">
                        <i class="fas fa-chart-line me-2"></i>
                        rednia cena:
                        <span th:text="${#numbers.formatDecimal(stats.avgPrice, 0, 'COMMA', 2, 'POINT') + ' z'}"></span>
                    </h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Top marki -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Najpopularniejsze marki</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Marka</th>
                        <th>Liczba samochod贸w</th>
                        <th>rednia cena</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="brand : ${topBrands}">
                        <td th:text="${brand.marka}"></td>
                        <td th:text="${brand.carCount}"></td>
                        <td th:text="${#numbers.formatDecimal(brand.avgPrice, 0, 'COMMA', 2, 'POINT') + ' z'}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Linki do innych raport贸w -->
    <div class="mt-4">
        <a href="/stats/sales" class="btn btn-outline-primary">
            <i class="fas fa-file-invoice-dollar me-1"></i> Raport sprzeda偶y
        </a>
        <a href="/admin" class="btn btn-secondary ms-2">
            <i class="fas fa-arrow-left me-1"></i> Powr贸t do panelu
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
